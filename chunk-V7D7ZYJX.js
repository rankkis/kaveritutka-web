import{a as S,b as k}from"./chunk-IKLCL2V4.js";import{a as P}from"./chunk-TZ2HGUHW.js";import"./chunk-X5YLR3NI.js";import{h as b,p as x,r as M}from"./chunk-642DS5T4.js";import{$a as s,Cb as h,Fb as a,Gb as c,Hb as f,Mb as C,Wb as l,Xb as v,eb as r,lb as g,qb as d}from"./chunk-3324XCKI.js";import{i as p}from"./chunk-ODN5LVDJ.js";function O(n,t){if(n&1&&(a(0,"p",2),l(1),c()),n&2){let e=C();s(),v(e.errorMessage)}}function A(n,t){n&1&&(a(0,"p",3),l(1,"Kirjaudutaan sis\xE4\xE4n..."),c())}var _=class n{constructor(t,e,o){this.route=t;this.router=e;this.supabaseService=o}errorMessage="";ngOnInit(){return p(this,null,function*(){console.log("AuthCallback: Processing OAuth callback"),console.log("Current URL:",window.location.href);let t=yield this.route.queryParams.toPromise(),e=t?.error;if(e){this.errorMessage="Kirjautuminen ep\xE4onnistui. Yrit\xE4 uudelleen.",console.error("OAuth error:",e),setTimeout(()=>this.router.navigate(["/"]),3e3);return}let o=t?.code;if(console.log("Authorization code:",o?"present":"missing"),o){console.log("Exchanging code for session...");try{let{data:i,error:m}=yield this.supabaseService.getClient().auth.exchangeCodeForSession(o);if(m||!i.session){console.error("Error exchanging code:",m),this.errorMessage="Kirjautuminen ep\xE4onnistui. Yrit\xE4 uudelleen.",setTimeout(()=>this.router.navigate(["/"]),2e3);return}console.log("Session established:",i.session.user.email),yield new Promise(w=>setTimeout(w,100)),window.history.replaceState({},document.title,window.location.pathname);let u=this.checkIfNewUser();console.log("Navigating to:",u?"/welcome":"/"),u?this.router.navigate(["/welcome"]):this.router.navigate(["/"])}catch(i){console.error("Exception during code exchange:",i),this.errorMessage="Kirjautuminen ep\xE4onnistui. Yrit\xE4 uudelleen.",setTimeout(()=>this.router.navigate(["/"]),2e3)}}else console.error("No authorization code in URL"),this.errorMessage="Kirjautuminen ep\xE4onnistui. Yrit\xE4 uudelleen.",setTimeout(()=>this.router.navigate(["/"]),2e3)})}checkIfNewUser(){return localStorage.getItem("hasSeenWelcome")?!1:(localStorage.setItem("hasSeenWelcome","true"),!0)}static \u0275fac=function(e){return new(e||n)(r(x),r(M),r(P))};static \u0275cmp=g({type:n,selectors:[["app-auth-callback"]],decls:4,vars:1,consts:[[1,"callback-container"],["diameter","60"],[1,"error-message"],[1,"loading-message"]],template:function(e,o){e&1&&(a(0,"div",0),f(1,"mat-spinner",1),d(2,O,2,1,"p",2)(3,A,2,0,"p",3),c()),e&2&&(s(2),h(o.errorMessage?2:3))},dependencies:[b,k,S],styles:[".callback-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:calc(100vh - 64px);padding:40px 20px;background-color:#f5f5f5;text-align:center}.callback-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:24px}.callback-container[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{font-size:18px;color:#000000b3;margin:0}.callback-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{font-size:16px;color:#f44336;margin:0}@media (max-width: 768px){.callback-container[_ngcontent-%COMP%]{min-height:calc(100vh - 56px);padding:32px 16px}.callback-container[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%], .callback-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{font-size:16px}}"]})};export{_ as AuthCallbackComponent};
