import{a as k,b as O}from"./chunk-7QRCO6OJ.js";import{a as _}from"./chunk-7NTURE7N.js";import"./chunk-X5YLR3NI.js";import{h as S,p as x,r as M}from"./chunk-UMRBOTZR.js";import{$a as c,B as p,Cb as b,Fb as a,Gb as r,H as g,Hb as h,Mb as v,Wb as l,Xb as C,eb as o,lb as d,qb as f}from"./chunk-6NKXEU3K.js";import{i as u}from"./chunk-ODN5LVDJ.js";function w(t,n){if(t&1&&(a(0,"p",2),l(1),r()),t&2){let e=v();c(),C(e.errorMessage)}}function I(t,n){t&1&&(a(0,"p",3),l(1,"Kirjaudutaan sis\xE4\xE4n..."),r())}var P=class t{constructor(n,e,i){this.route=n;this.router=e;this.supabaseService=i}errorMessage="";sessionSubscription;ngOnInit(){return u(this,null,function*(){console.log("AuthCallback: Waiting for Supabase auto-detection");let e=(yield this.route.queryParams.toPromise())?.error;if(e){this.errorMessage="Kirjautuminen ep\xE4onnistui. Yrit\xE4 uudelleen.",console.error("OAuth error:",e),setTimeout(()=>this.router.navigate(["/"]),3e3);return}console.log("Subscribing to session changes...");let i=setTimeout(()=>{console.error("Timeout waiting for session after OAuth callback"),this.errorMessage="Kirjautuminen ep\xE4onnistui. Yrit\xE4 uudelleen.",setTimeout(()=>this.router.navigate(["/"]),2e3)},1e4);this.sessionSubscription=this.supabaseService.session$.pipe(p(s=>s!==null),g(1)).subscribe(s=>{clearTimeout(i),console.log("Session received:",s.user.email),window.history.replaceState({},document.title,window.location.pathname);let m=this.checkIfNewUser();console.log("Navigating to:",m?"/welcome":"/"),m?this.router.navigate(["/welcome"]):this.router.navigate(["/"])})})}ngOnDestroy(){this.sessionSubscription&&this.sessionSubscription.unsubscribe()}checkIfNewUser(){return localStorage.getItem("hasSeenWelcome")?!1:(localStorage.setItem("hasSeenWelcome","true"),!0)}static \u0275fac=function(e){return new(e||t)(o(x),o(M),o(_))};static \u0275cmp=d({type:t,selectors:[["app-auth-callback"]],decls:4,vars:1,consts:[[1,"callback-container"],["diameter","60"],[1,"error-message"],[1,"loading-message"]],template:function(e,i){e&1&&(a(0,"div",0),h(1,"mat-spinner",1),f(2,w,2,1,"p",2)(3,I,2,0,"p",3),r()),e&2&&(c(2),b(i.errorMessage?2:3))},dependencies:[S,O,k],styles:[".callback-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:calc(100vh - 64px);padding:40px 20px;background-color:#f5f5f5;text-align:center}.callback-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:24px}.callback-container[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{font-size:18px;color:#000000b3;margin:0}.callback-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{font-size:16px;color:#f44336;margin:0}@media (max-width: 768px){.callback-container[_ngcontent-%COMP%]{min-height:calc(100vh - 56px);padding:32px 16px}.callback-container[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%], .callback-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{font-size:16px}}"]})};export{P as AuthCallbackComponent};
