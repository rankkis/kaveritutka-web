import{a as Je,b as Qe}from"./chunk-VB2HNPEO.js";import{a as Xe,c as et,e as tt,f as it,g as nt}from"./chunk-F2P2FTFN.js";import{a as B,b as j}from"./chunk-VQVCNQR2.js";import{a as Ae,c as O,f as ze,h as me,i as ce,j as ae,k as He,l as $e,m as pe,n as Ke,o as Ue,p as We,q as Ye,r as Ze}from"./chunk-VJJCL42P.js";import{C as T,D as V,b as D,d as b,f as F,g as Y,i as Le,j as Z,k as J,l as Q,m as X,n as ee,o as Be,p as te,q as w,r as ie,s as ne,t as je,u as Ge,x as I,y as R}from"./chunk-JZXY3VKR.js";import{a as G,b as H,c as Ne,d as $,e as K,f as U,g as W}from"./chunk-XCSZKJFW.js";import"./chunk-C7L66KLB.js";import{a as Te}from"./chunk-765JHOPI.js";import{o as q,p as P}from"./chunk-R7O3L3SZ.js";import{b as Re}from"./chunk-YAXX6ZQB.js";import"./chunk-X5YLR3NI.js";import{Q as Ve,Z as Ce,e as k,f as E,i as S,t as Ie}from"./chunk-HGBHGORQ.js";import{$a as s,$b as r,Ab as d,Cb as N,H as M,Ib as n,Jb as i,Kb as y,Ob as v,Qb as u,Rb as p,_ as Oe,_b as we,ac as A,bc as g,cc as L,da as De,dc as se,eb as h,ec as le,fc as de,la as f,lb as x,ma as _,mb as Fe,rb as c,wa as z}from"./chunk-LH7KODYS.js";import"./chunk-ODN5LVDJ.js";var at=(()=>{class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=Fe({type:o});static \u0275inj=Oe({imports:[Ve,Ce,Ce]})}return o})();function st(o,a){o&1&&(n(0,"mat-chip",14),r(1," Ratkaistu "),i())}function lt(o,a){o&1&&(n(0,"mat-chip",15),r(1," Aktiivinen "),i())}function dt(o,a){if(o&1&&(n(0,"mat-chip",18),r(1),i()),o&2){let t=a.$implicit;s(),g(" ",t," ")}}function mt(o,a){if(o&1&&(n(0,"div",16)(1,"mat-chip-set"),c(2,dt,2,1,"mat-chip",17),i()()),o&2){let t=p();s(2),d("ngForOf",t.request.interests)}}function ct(o,a){if(o&1){let t=v();n(0,"a",19),u("click",function(){f(t);let l=p();return _(l.toggleDescription())}),r(1),i()}if(o&2){let t=p();s(),g(" ",t.showFullDescription?"N\xE4yt\xE4 v\xE4hemm\xE4n":"Lue lis\xE4\xE4"," ")}}function pt(o,a){if(o&1){let t=v();n(0,"div",20)(1,"button",21),u("click",function(){f(t);let l=p();return _(l.onSendMessage())}),n(2,"mat-icon"),r(3,"mail"),i(),r(4," L\xE4het\xE4 viesti "),i(),n(5,"button",22),u("click",function(){f(t);let l=p();return _(l.onProposePlaytime())}),n(6,"mat-icon"),r(7,"event"),i(),r(8," Ehdota leikkiaikaa "),i()()}}function ut(o,a){if(o&1){let t=v();n(0,"button",26),u("click",function(){f(t);let l=p(2);return _(l.onEdit())}),n(1,"mat-icon"),r(2,"edit"),i(),r(3," Muokkaa "),i()}}function gt(o,a){if(o&1){let t=v();n(0,"div",23),c(1,ut,4,0,"button",24),n(2,"button",25),u("click",function(){f(t);let l=p();return _(l.onDelete())}),n(3,"mat-icon"),r(4,"delete"),i(),r(5," Poista "),i()()}if(o&2){let t=p();s(),d("ngIf",t.request.status==="active")}}var ue=class o{request;isOwner=!1;sendMessage=new z;proposePlaytime=new z;edit=new z;delete=new z;close=new z;showFullDescription=!1;get isLongDescription(){return this.request.description.length>150}get displayDescription(){return this.showFullDescription||!this.isLongDescription?this.request.description:this.request.description.substring(0,150)+"..."}toggleDescription(){this.showFullDescription=!this.showFullDescription}onSendMessage(){this.sendMessage.emit(this.request)}onProposePlaytime(){this.proposePlaytime.emit(this.request)}onEdit(){this.edit.emit(this.request)}onDelete(){confirm("Haluatko varmasti poistaa t\xE4m\xE4n ilmoituksen?")&&this.delete.emit(this.request)}onClose(){confirm("Haluatko merkit\xE4 ilmoituksen ratkaistuksi?")&&this.close.emit(this.request)}getRelativeTime(){let a=new Date,t=new Date(this.request.createdAt),e=a.getTime()-t.getTime(),l=Math.floor(e/6e4),m=Math.floor(l/60),C=Math.floor(m/24);return l<60?`${l} minuuttia sitten`:m<24?`${m} tuntia sitten`:C<7?`${C} p\xE4iv\xE4\xE4 sitten`:t.toLocaleDateString("fi-FI")}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=x({type:o,selectors:[["app-friend-request-card"]],inputs:{request:"request",isOwner:"isOwner"},outputs:{sendMessage:"sendMessage",proposePlaytime:"proposePlaytime",edit:"edit",delete:"delete",close:"close"},decls:28,vars:14,consts:[[1,"friend-request-card"],[1,"card-header-content"],[1,"child-info"],[1,"child-name"],[1,"parent-name"],["class","status-chip closed",4,"ngIf"],["class","status-chip active",4,"ngIf"],["class","interests-section",4,"ngIf"],[1,"description"],["class","read-more-link",3,"click",4,"ngIf"],[1,"location"],[1,"created-date"],["class","public-actions",4,"ngIf"],["class","owner-actions",4,"ngIf"],[1,"status-chip","closed"],[1,"status-chip","active"],[1,"interests-section"],["class","interest-chip",4,"ngFor","ngForOf"],[1,"interest-chip"],[1,"read-more-link",3,"click"],[1,"public-actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"owner-actions"],["mat-raised-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","",3,"click"]],template:function(t,e){t&1&&(n(0,"mat-card",0)(1,"mat-card-header")(2,"div",1)(3,"div",2)(4,"h3",3),r(5),i(),n(6,"span",4),r(7),i()(),c(8,st,2,0,"mat-chip",5)(9,lt,2,0,"mat-chip",6),i()(),n(10,"mat-card-content"),c(11,mt,3,1,"div",7),n(12,"p",8),r(13),c(14,ct,2,1,"a",9),i(),n(15,"div",10)(16,"mat-icon"),r(17,"location_on"),i(),n(18,"span"),r(19),i()(),n(20,"div",11)(21,"mat-icon"),r(22,"schedule"),i(),n(23,"span"),r(24),i()()(),n(25,"mat-card-actions"),c(26,pt,9,0,"div",12)(27,gt,6,1,"div",13),i()()),t&2&&(N("closed",e.request.status==="closed"),s(5),L("",e.request.childName,", ",e.request.childAge," v"),s(2),g("Vanhempi: ",e.request.parentName,""),s(),d("ngIf",e.request.status==="closed"),s(),d("ngIf",e.request.status==="active"),s(2),d("ngIf",e.request.interests&&e.request.interests.length>0),s(2),g(" ",e.displayDescription," "),s(),d("ngIf",e.isLongDescription),s(5),A(e.request.city),s(5),A(e.getRelativeTime()),s(2),d("ngIf",!e.isOwner&&e.request.status==="active"),s(),d("ngIf",e.isOwner))},dependencies:[S,k,E,nt,Xe,tt,et,it,P,q,j,B,pe,He,$e,at],styles:[".friend-listing-card[_ngcontent-%COMP%]{margin-bottom:16px;transition:all .3s ease}.friend-listing-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #00000026}.friend-listing-card.closed[_ngcontent-%COMP%]{opacity:.7;background-color:#f5f5f5}.card-header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;width:100%;gap:16px}.child-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;flex:1}.child-info[_ngcontent-%COMP%]   .child-name[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;color:#673ab7}.child-info[_ngcontent-%COMP%]   .parent-name[_ngcontent-%COMP%]{font-size:14px;color:#0009}.status-chip.active[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important}.status-chip.closed[_ngcontent-%COMP%]{background-color:#9e9e9e!important;color:#fff!important}mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding-top:16px}.interests-section[_ngcontent-%COMP%]   mat-chip-set[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.interests-section[_ngcontent-%COMP%]   .interest-chip[_ngcontent-%COMP%]{background-color:#673ab71a;color:#673ab7;font-size:12px}.description[_ngcontent-%COMP%]{margin:0;line-height:1.6;color:#000000de;white-space:pre-wrap;word-wrap:break-word}.description[_ngcontent-%COMP%]   .read-more-link[_ngcontent-%COMP%]{color:#673ab7;cursor:pointer;text-decoration:none;margin-left:4px;font-weight:500}.description[_ngcontent-%COMP%]   .read-more-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.location[_ngcontent-%COMP%], .created-date[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:14px;color:#0009}.location[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .created-date[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:#673ab7}mat-card-actions[_ngcontent-%COMP%]{padding:16px;display:flex;justify-content:flex-end}mat-card-actions[_ngcontent-%COMP%]   .public-actions[_ngcontent-%COMP%], mat-card-actions[_ngcontent-%COMP%]   .owner-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap;width:100%}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:0}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px;font-size:18px;width:18px;height:18px}@media (max-width: 768px){.card-header-content[_ngcontent-%COMP%]{flex-direction:column}mat-card-actions[_ngcontent-%COMP%]   .public-actions[_ngcontent-%COMP%], mat-card-actions[_ngcontent-%COMP%]   .owner-actions[_ngcontent-%COMP%]{width:100%;flex-direction:column}mat-card-actions[_ngcontent-%COMP%]   .public-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], mat-card-actions[_ngcontent-%COMP%]   .owner-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;flex:none}}"]})};function ft(o,a){o&1&&(n(0,"mat-error"),r(1," Lapsen nimi on pakollinen "),i())}function _t(o,a){o&1&&(n(0,"mat-error"),r(1," Nimi voi olla enint\xE4\xE4n 255 merkki\xE4 "),i())}function ht(o,a){if(o&1){let t=v();n(0,"button",21),u("click",function(){let l=f(t).$implicit,m=p();return _(m.selectAge(l))}),r(1),i()}if(o&2){let t=a.$implicit,e=p();N("selected",e.selectedAge===t),s(),g(" ",t,"v ")}}function vt(o,a){o&1&&(n(0,"div",22),r(1," Valitse lapsen ik\xE4 "),i())}function bt(o,a){if(o&1){let t=v();n(0,"button",23),u("click",function(){let l=f(t).$implicit,m=p();return _(m.selectGender(l.value))}),n(1,"span",24),r(2),i(),n(3,"span",25),r(4),i()()}if(o&2){let t=a.$implicit,e=p();N("selected",e.selectedGender===t.value),s(2),A(t.icon),s(2),A(t.label)}}function Ct(o,a){if(o&1){let t=v();n(0,"button",26),u("click",function(){f(t);let l=p();return _(l.removeGenderSelection())}),r(1," Poista valinta "),i()}}function xt(o,a){if(o&1){let t=v();n(0,"button",27),u("click",function(){let l=f(t).$implicit,m=p();return _(m.toggleInterest(l))}),r(1),i()}if(o&2){let t=a.$implicit,e=p();N("selected",e.isInterestSelected(t)),s(),g(" ",t," ")}}function Mt(o,a){o&1&&(n(0,"div",22),r(1," Valitse v\xE4hint\xE4\xE4n yksi kiinnostuksen kohde "),i())}function yt(o,a){o&1&&(n(0,"mat-error"),r(1," Kuvaus on pakollinen "),i())}function Et(o,a){o&1&&(n(0,"mat-error"),r(1," Kuvaus voi olla enint\xE4\xE4n 500 merkki\xE4 "),i())}var he=class o{constructor(a,t,e,l){this.fb=a;this.friendRequestService=t;this.dialogRef=e;this.data=l}form;isSubmitting=!1;availableInterests=["Jalkapallo","Keinut","Liukum\xE4et","Hiekkalaatikko","Kiipeily","Juokseminen","Py\xF6r\xE4ily","Pallopelit","Piirt\xE4minen","Ulkoilu","El\xE4imet"];selectedInterests=[];ageOptions=[0,1,2,3,4,5,6,7];selectedAge=null;selectedGender=null;genderOptions=[{value:"boy",icon:"\u{1F466}",label:"Poika"},{value:"girl",icon:"\u{1F467}",label:"Tytt\xF6"}];userService=De(Te);ngOnInit(){this.form=this.fb.group({childName:["",[b.required,b.maxLength(255)]],description:["",[b.required,b.maxLength(500)]]})}selectAge(a){this.selectedAge=a}selectGender(a){this.selectedGender=a}removeGenderSelection(){this.selectedGender=null}toggleInterest(a){let t=this.selectedInterests.indexOf(a);t>=0?this.selectedInterests.splice(t,1):this.selectedInterests.push(a)}isInterestSelected(a){return this.selectedInterests.includes(a)}onSubmit(){if(this.form.invalid||this.selectedInterests.length===0||this.selectedAge===null||this.isSubmitting)return;this.isSubmitting=!0;let e={parentName:this.userService.getCurrentUserValue()?.displayName||"Anonyymi",childName:this.form.value.childName,childAge:this.selectedAge,description:this.form.value.description,interests:this.selectedInterests,latitude:this.data.latitude,longitude:this.data.longitude,city:this.data.city};console.log("Creating friend request with DTO:",e),this.friendRequestService.createFriendRequest(e).pipe(M(1)).subscribe({next:l=>{console.log("Friend request created successfully:",l),this.dialogRef.close(l)},error:l=>{console.error("Error creating friend request:",l),console.error("Error details:",l.error);let m="Kaverihakuilmoituksen luominen ep\xE4onnistui.";l.status===401?m="Kirjaudu sis\xE4\xE4n luodaksesi ilmoituksen.":l.error?.message&&(m=l.error.message),alert(m+" Yrit\xE4 uudelleen."),this.isSubmitting=!1}})}onCancel(){this.dialogRef.close()}get remainingChars(){return 500-(this.form.get("description")?.value||"").length}get childLegend(){let a=this.form.get("childName")?.value||"";return a&&this.selectedAge!==null?`${a} (${this.selectedAge}v.)`:this.selectedAge!==null?`Lapsi (${this.selectedAge}v.)`:a||"Lapsen tiedot"}static \u0275fac=function(t){return new(t||o)(h(ee),h(O),h(G),h(H))};static \u0275cmp=x({type:o,selectors:[["app-friend-request-create-dialog"]],decls:49,vars:17,consts:[["mat-dialog-title",""],[1,"app-form",3,"formGroup"],[1,"form-fieldset"],[1,"fieldset-legend"],["appearance","outline",1,"full-width"],["matInput","","formControlName","childName","placeholder","Esim. Emma","required",""],[4,"ngIf"],[1,"form-section"],[1,"section-label"],[1,"chip-row"],["type","button","class","selection-chip age-chip",3,"selected","click",4,"ngFor","ngForOf"],["class","error-message",4,"ngIf"],["type","button","class","selection-chip gender-chip",3,"selected","click",4,"ngFor","ngForOf"],["type","button","class","selection-chip remove-selection-btn",3,"click",4,"ngIf"],[1,"interests-grid"],["type","button","class","interest-chip",3,"selected","click",4,"ngFor","ngForOf"],["matInput","","formControlName","description","rows","6","placeholder","Kerro lapsestasi ja mit\xE4 etsitte. Esim. erityistarpeet, toiveet leikkikaverin suhteen...","required",""],["align","end"],[1,"info-box"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["type","button",1,"selection-chip","age-chip",3,"click"],[1,"error-message"],["type","button",1,"selection-chip","gender-chip",3,"click"],[1,"icon"],[1,"label"],["type","button",1,"selection-chip","remove-selection-btn",3,"click"],["type","button",1,"interest-chip",3,"click"]],template:function(t,e){if(t&1&&(n(0,"h2",0),r(1,"Luo kaverihakuilmoitus"),i(),n(2,"mat-dialog-content")(3,"form",1)(4,"fieldset",2)(5,"legend",3),r(6),i(),n(7,"mat-form-field",4)(8,"mat-label"),r(9,"Lapsen nimi"),i(),y(10,"input",5),c(11,ft,2,0,"mat-error",6)(12,_t,2,0,"mat-error",6),i(),n(13,"div",7)(14,"label",8),r(15,"Lapsen ik\xE4"),i(),n(16,"div",9),c(17,ht,2,3,"button",10),i(),c(18,vt,2,0,"div",11),i(),n(19,"div",7)(20,"label",8),r(21,"Sukupuoli (valinnainen)"),i(),n(22,"div",9),c(23,bt,5,4,"button",12)(24,Ct,2,0,"button",13),i()(),n(25,"div",7)(26,"label",8),r(27,"Kiinnostuksen kohteet (valitse v\xE4hint\xE4\xE4n yksi)"),i(),n(28,"div",14),c(29,xt,2,3,"button",15),i(),c(30,Mt,2,0,"div",11),i(),n(31,"mat-form-field",4)(32,"mat-label"),r(33,"Kuvaus"),i(),y(34,"textarea",16),n(35,"mat-hint",17),r(36),i(),c(37,yt,2,0,"mat-error",6)(38,Et,2,0,"mat-error",6),i()(),n(39,"div",18)(40,"mat-icon"),r(41,"location_on"),i(),n(42,"span"),r(43),i()()()(),n(44,"mat-dialog-actions",17)(45,"button",19),u("click",function(){return e.onCancel()}),r(46," Peruuta "),i(),n(47,"button",20),u("click",function(){return e.onSubmit()}),r(48),i()()),t&2){let l,m,C,oe;s(3),d("formGroup",e.form),s(3),A(e.childLegend),s(5),d("ngIf",(l=e.form.get("childName"))==null?null:l.hasError("required")),s(),d("ngIf",(m=e.form.get("childName"))==null?null:m.hasError("maxlength")),s(5),d("ngForOf",e.ageOptions),s(),d("ngIf",e.selectedAge===null),s(5),d("ngForOf",e.genderOptions),s(),d("ngIf",e.selectedGender!==null),s(5),d("ngForOf",e.availableInterests),s(),d("ngIf",e.selectedInterests.length===0),s(6),g("",e.remainingChars," / 500 merkki\xE4 j\xE4ljell\xE4"),s(),d("ngIf",(C=e.form.get("description"))==null?null:C.hasError("required")),s(),d("ngIf",(oe=e.form.get("description"))==null?null:oe.hasError("maxlength")),s(5),g("Sijainti: ",e.data.city,""),s(2),d("disabled",e.isSubmitting),s(2),d("disabled",e.form.invalid||e.selectedInterests.length===0||e.selectedAge===null||e.isSubmitting),s(),g(" ",e.isSubmitting?"Luodaan...":"Luo ilmoitus"," ")}},dependencies:[S,k,E,te,Z,D,F,Y,X,J,Q,W,$,U,K,P,q,R,I,w,ne,ie,V,T,ae,pe,j,B],styles:[".app-form[_ngcontent-%COMP%]{min-width:400px}@media (max-width: 768px){.app-form[_ngcontent-%COMP%]{min-width:280px}}mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px}"]})};function St(o,a){o&1&&(n(0,"mat-error"),r(1," Viesti on pakollinen "),i())}function qt(o,a){o&1&&(n(0,"mat-error"),r(1," Viesti voi olla enint\xE4\xE4n 300 merkki\xE4 "),i())}var ve=class o{constructor(a,t,e,l){this.fb=a;this.friendRequestService=t;this.dialogRef=e;this.data=l}form;isSubmitting=!1;ngOnInit(){this.form=this.fb.group({message:["",[b.required,b.maxLength(300)]]})}onSubmit(){if(this.form.invalid||this.isSubmitting)return;this.isSubmitting=!0;let a={requestId:this.data.request.id,message:this.form.value.message};this.friendRequestService.sendMessage(a).pipe(M(1)).subscribe({next:()=>{alert("Viesti l\xE4hetetty onnistuneesti! Ilmoituksen luoja saa sen s\xE4hk\xF6postiinsa."),this.dialogRef.close(!0)},error:t=>{console.error("Error sending message:",t),alert("Viestin l\xE4hett\xE4minen ep\xE4onnistui. Yrit\xE4 uudelleen."),this.isSubmitting=!1}})}onCancel(){this.dialogRef.close()}get remainingChars(){return 300-(this.form.get("message")?.value||"").length}static \u0275fac=function(t){return new(t||o)(h(ee),h(O),h(G),h(H))};static \u0275cmp=x({type:o,selectors:[["app-send-message-dialog"]],decls:25,vars:10,consts:[["mat-dialog-title",""],[1,"request-info"],[1,"message-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","message","rows","8","placeholder","Hei! Meill\xE4 on my\xF6s sammanik\xE4inen lapsi. Haluaisitko jutella lis\xE4\xE4 ja sopia yhteisest\xE4 leikkiajasta?","required",""],["align","end"],[4,"ngIf"],[1,"info-box"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,e){if(t&1&&(n(0,"h2",0),r(1,"L\xE4het\xE4 viesti"),i(),n(2,"mat-dialog-content")(3,"div",1)(4,"h3"),r(5),i(),n(6,"p"),r(7),i()(),n(8,"form",2)(9,"mat-form-field",3)(10,"mat-label"),r(11,"Viestisi"),i(),y(12,"textarea",4),n(13,"mat-hint",5),r(14),i(),c(15,St,2,0,"mat-error",6)(16,qt,2,0,"mat-error",6),i(),n(17,"div",7)(18,"p"),r(19,"\u{1F4A1} Vinkki: Kerro lyhyesti lapsestasi ja miksi otit yhteytt\xE4. Ilmoituksen luoja saa viestisi s\xE4hk\xF6postiinsa."),i()()()(),n(20,"mat-dialog-actions",5)(21,"button",8),u("click",function(){return e.onCancel()}),r(22," Peruuta "),i(),n(23,"button",9),u("click",function(){return e.onSubmit()}),r(24),i()()),t&2){let l,m;s(5),L("",e.data.request.childName,", ",e.data.request.childAge," v"),s(2),g("Vanhempi: ",e.data.request.parentName,""),s(),d("formGroup",e.form),s(6),g("",e.remainingChars," / 300 merkki\xE4 j\xE4ljell\xE4"),s(),d("ngIf",(l=e.form.get("message"))==null?null:l.hasError("required")),s(),d("ngIf",(m=e.form.get("message"))==null?null:m.hasError("maxlength")),s(5),d("disabled",e.isSubmitting),s(2),d("disabled",e.form.invalid||e.isSubmitting),s(),g(" ",e.isSubmitting?"L\xE4hetet\xE4\xE4n...":"L\xE4het\xE4 viesti"," ")}},dependencies:[S,E,te,Z,D,F,Y,X,J,Q,W,$,U,K,P,q,R,I,w,ne,ie,V,T],styles:[".listing-info[_ngcontent-%COMP%]{background-color:#673ab70d;padding:16px;border-radius:4px;margin-bottom:24px}.listing-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#673ab7;font-size:18px;font-weight:600}.listing-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#0009;font-size:14px}.message-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.info-box[_ngcontent-%COMP%]{background-color:#e8f5e9;border-left:4px solid #4caf50;padding:12px 16px;border-radius:4px}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.5;color:#000c}mat-dialog-content[_ngcontent-%COMP%]{min-width:400px;max-height:70vh;overflow-y:auto}@media (max-width: 768px){mat-dialog-content[_ngcontent-%COMP%]{min-width:280px}}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px}"]})};function kt(o,a){if(o&1&&(n(0,"div",18)(1,"strong"),r(2,"Kiinnostukset:"),i(),r(3),i()),o&2){let t=p();s(3),g(" ",t.data.request.interests.join(", ")," ")}}function Ot(o,a){if(o&1&&(n(0,"mat-option",19),r(1),i()),o&2){let t=a.$implicit;d("value",t.id),s(),g(" ",t.name," ")}}function Dt(o,a){o&1&&(n(0,"mat-error"),r(1," Valitse leikkipuisto "),i())}function Ft(o,a){o&1&&(n(0,"mat-error"),r(1," Valitse p\xE4iv\xE4m\xE4\xE4r\xE4 "),i())}function wt(o,a){if(o&1&&(n(0,"mat-option",19),r(1),i()),o&2){let t=a.$implicit;d("value",t),s(),g(" ",t," ")}}function It(o,a){o&1&&(n(0,"mat-error"),r(1," Valitse kellonaika "),i())}function Rt(o,a){if(o&1&&(n(0,"mat-option",19),r(1),i()),o&2){let t=a.$implicit;d("value",t),s(),g(" ",t," h ")}}function Tt(o,a){o&1&&(n(0,"mat-error"),r(1," Valitse kesto "),i())}function Vt(o,a){o&1&&(n(0,"mat-error"),r(1," Viesti on pakollinen "),i())}function Nt(o,a){o&1&&(n(0,"mat-error"),r(1," Viesti voi olla enint\xE4\xE4n 300 merkki\xE4 "),i())}var be=class o{constructor(a,t,e,l,m){this.fb=a;this.friendRequestService=t;this.playgroundService=e;this.dialogRef=l;this.data=m}form;isSubmitting=!1;playgrounds=[];timeSlots=[];durationOptions=[.5,1,1.5,2];minDate=new Date;ngOnInit(){this.timeSlots=ze(),this.form=this.fb.group({playgroundId:["",b.required],date:["",b.required],time:["",b.required],duration:[1,b.required],message:["",[b.required,b.maxLength(300)]]}),this.playgroundService.getPlaygrounds().pipe(M(1)).subscribe(a=>{this.playgrounds=a})}onSubmit(){if(this.form.invalid||this.isSubmitting)return;this.isSubmitting=!0;let a=this.form.value,t=this.playgrounds.find(C=>C.id===a.playgroundId);if(!t){alert("Valitse leikkipuisto"),this.isSubmitting=!1;return}let l=new Date(a.date).toISOString().split("T")[0],m={requestId:this.data.request.id,message:a.message,playtimeDetails:{date:l,time:a.time,location:t.name,duration:a.duration,notes:""}};this.friendRequestService.proposePlaytime(m).pipe(M(1)).subscribe({next:()=>{alert("Leikkiaika-ehdotus l\xE4hetetty onnistuneesti! Ilmoituksen luoja saa sen s\xE4hk\xF6postiinsa."),this.dialogRef.close(!0)},error:C=>{console.error("Error proposing playtime:",C),alert("Ehdotuksen l\xE4hett\xE4minen ep\xE4onnistui. Yrit\xE4 uudelleen."),this.isSubmitting=!1}})}onCancel(){this.dialogRef.close()}get remainingChars(){return 300-(this.form.get("message")?.value||"").length}static \u0275fac=function(t){return new(t||o)(h(ee),h(O),h(Ae),h(G),h(H))};static \u0275cmp=x({type:o,selectors:[["app-propose-playtime-dialog"]],decls:52,vars:21,consts:[["picker",""],["mat-dialog-title",""],[1,"request-info"],["class","interests",4,"ngIf"],[1,"playtime-form",3,"formGroup"],["appearance","outline",1,"full-width"],["formControlName","playgroundId","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","formControlName","date","placeholder","Valitse p\xE4iv\xE4","required","",3,"matDatepicker","min"],["matSuffix","",3,"for"],["formControlName","time","required",""],["formControlName","duration","required",""],["matInput","","formControlName","message","rows","5","placeholder","Haluaisitko tulla leikkim\xE4\xE4n huomenna? Voimme sopia tarkemman ajan!","required",""],["align","end"],[1,"info-box"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"interests"],[3,"value"]],template:function(t,e){if(t&1){let l=v();n(0,"h2",1),r(1,"Ehdota leikkiaikaa"),i(),n(2,"mat-dialog-content")(3,"div",2)(4,"h3"),r(5),i(),n(6,"p"),r(7),i(),c(8,kt,4,1,"div",3),i(),n(9,"form",4)(10,"mat-form-field",5)(11,"mat-label"),r(12,"Leikkipuisto"),i(),n(13,"mat-select",6),c(14,Ot,2,2,"mat-option",7),i(),c(15,Dt,2,0,"mat-error",8),i(),n(16,"mat-form-field",5)(17,"mat-label"),r(18,"P\xE4iv\xE4m\xE4\xE4r\xE4"),i(),y(19,"input",9)(20,"mat-datepicker-toggle",10)(21,"mat-datepicker",null,0),c(23,Ft,2,0,"mat-error",8),i(),n(24,"mat-form-field",5)(25,"mat-label"),r(26,"Kellonaika"),i(),n(27,"mat-select",11),c(28,wt,2,2,"mat-option",7),i(),c(29,It,2,0,"mat-error",8),i(),n(30,"mat-form-field",5)(31,"mat-label"),r(32,"Kesto"),i(),n(33,"mat-select",12),c(34,Rt,2,2,"mat-option",7),i(),c(35,Tt,2,0,"mat-error",8),i(),n(36,"mat-form-field",5)(37,"mat-label"),r(38,"Viestisi"),i(),y(39,"textarea",13),n(40,"mat-hint",14),r(41),i(),c(42,Vt,2,0,"mat-error",8)(43,Nt,2,0,"mat-error",8),i(),n(44,"div",15)(45,"p"),r(46,"\u{1F4A1} Ehdotettu aika on alustava. Voitte sopia tarkan ajan yhdess\xE4 viestien kautta."),i()()()(),n(47,"mat-dialog-actions",14)(48,"button",16),u("click",function(){return f(l),_(e.onCancel())}),r(49," Peruuta "),i(),n(50,"button",17),u("click",function(){return f(l),_(e.onSubmit())}),r(51),i()()}if(t&2){let l,m,C,oe,qe,Pe,ke=we(22);s(5),L("",e.data.request.childName,", ",e.data.request.childAge," v"),s(2),g("Vanhempi: ",e.data.request.parentName,""),s(),d("ngIf",e.data.request.interests&&e.data.request.interests.length>0),s(),d("formGroup",e.form),s(5),d("ngForOf",e.playgrounds),s(),d("ngIf",(l=e.form.get("playgroundId"))==null?null:l.hasError("required")),s(4),d("matDatepicker",ke)("min",e.minDate),s(),d("for",ke),s(3),d("ngIf",(m=e.form.get("date"))==null?null:m.hasError("required")),s(5),d("ngForOf",e.timeSlots),s(),d("ngIf",(C=e.form.get("time"))==null?null:C.hasError("required")),s(5),d("ngForOf",e.durationOptions),s(),d("ngIf",(oe=e.form.get("duration"))==null?null:oe.hasError("required")),s(6),g("",e.remainingChars," / 300 merkki\xE4 j\xE4ljell\xE4"),s(),d("ngIf",(qe=e.form.get("message"))==null?null:qe.hasError("required")),s(),d("ngIf",(Pe=e.form.get("message"))==null?null:Pe.hasError("maxlength")),s(5),d("disabled",e.isSubmitting),s(2),d("disabled",e.form.invalid||e.isSubmitting),s(),g(" ",e.isSubmitting?"L\xE4hetet\xE4\xE4n...":"L\xE4het\xE4 ehdotus"," ")}},dependencies:[S,k,E,te,Z,D,F,Y,X,J,Q,W,$,U,K,P,q,R,I,w,ne,ie,Ge,V,T,Ye,Ke,Ue,We,Ze,ae,ce,me],styles:[".listing-info[_ngcontent-%COMP%]{background-color:#673ab70d;padding:16px;border-radius:4px;margin-bottom:24px}.listing-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#673ab7;font-size:18px;font-weight:600}.listing-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;color:#0009;font-size:14px}.listing-info[_ngcontent-%COMP%]   .interests[_ngcontent-%COMP%]{font-size:14px;color:#000c;margin-top:8px}.listing-info[_ngcontent-%COMP%]   .interests[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#673ab7}.playtime-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.info-box[_ngcontent-%COMP%]{background-color:#fff3e0;border-left:4px solid #ff9800;padding:12px 16px;border-radius:4px}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.5;color:#000c}mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;max-height:70vh;overflow-y:auto}@media (max-width: 768px){mat-dialog-content[_ngcontent-%COMP%]{min-width:280px}}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px}"]})};function At(o,a){o&1&&(n(0,"div",14),y(1,"mat-spinner"),i())}function zt(o,a){o&1&&(n(0,"p"),r(1," Kokeile muuttaa hakuehtoja. "),i())}function Lt(o,a){o&1&&(n(0,"p"),r(1," Ole ensimm\xE4inen ja luo ilmoitus! "),i())}function Bt(o,a){if(o&1){let t=v();n(0,"div",18)(1,"mat-icon"),r(2,"inbox"),i(),n(3,"h3"),r(4,"Ei ilmoituksia"),i(),c(5,zt,2,0,"p",19)(6,Lt,2,0,"p",19),n(7,"button",20),u("click",function(){f(t);let l=p(2);return _(l.onCreateRequest())}),n(8,"mat-icon"),r(9,"add"),i(),r(10," Luo ilmoitus "),i()()}if(o&2){let t=p(2);s(5),d("ngIf",t.searchText||t.selectedAge!==null),s(),d("ngIf",!t.searchText&&t.selectedAge===null)}}function jt(o,a){if(o&1){let t=v();n(0,"app-friend-request-card",24),u("sendMessage",function(l){f(t);let m=p(3);return _(m.onSendMessage(l))})("proposePlaytime",function(l){f(t);let m=p(3);return _(m.onProposePlaytime(l))})("edit",function(l){f(t);let m=p(3);return _(m.onEditRequest(l))})("delete",function(l){f(t);let m=p(3);return _(m.onDeleteRequest(l))})("close",function(l){f(t);let m=p(3);return _(m.onCloseRequest(l))}),i()}if(o&2){let t=a.$implicit,e=p(3);d("request",t)("isOwner",e.isOwner(t))}}function Gt(o,a){if(o&1){let t=v();n(0,"div",21),c(1,jt,1,2,"app-friend-request-card",22),n(2,"div",23),u("click",function(){f(t);let l=p(2);return _(l.onCreateRequest())}),n(3,"mat-icon"),r(4,"add"),i(),n(5,"span"),r(6,"Uusi kaverihaku"),i()()()}if(o&2){let t=p(2);s(),d("ngForOf",t.filteredRequests)}}function Ht(o,a){if(o&1&&(n(0,"div",15),c(1,Bt,11,2,"div",16)(2,Gt,7,1,"div",17),i()),o&2){let t=p();s(),d("ngIf",t.filteredRequests.length===0),s(),d("ngIf",t.filteredRequests.length>0)}}function $t(o,a){if(o&1&&(n(0,"mat-option",12),r(1),i()),o&2){let t=a.$implicit;d("value",t),s(),g(" ",t," vuotta ")}}var rt=class o{constructor(a,t,e,l){this.friendRequestService=a;this.supabaseService=t;this.dialog=e;this.router=l}requests=[];filteredRequests=[];isLoading=!0;currentUserId=null;searchText="";selectedStatus="active";selectedAge=null;requestsSubscription;ageOptions=[0,1,2,3,4,5,6,7];ngOnInit(){let a=this.supabaseService.getSession();this.currentUserId=a?.user?.id||null,this.requestsSubscription=this.friendRequestService.getAllRequests().subscribe(t=>{this.requests=t,this.applyFilters(),this.isLoading=!1})}ngOnDestroy(){this.requestsSubscription?.unsubscribe()}applyFilters(){let a=[...this.requests];if(this.selectedStatus!=="all"&&(a=a.filter(t=>t.status===this.selectedStatus)),this.selectedAge!==null&&(a=a.filter(t=>t.childAge===this.selectedAge)),this.searchText.trim()){let t=this.searchText.toLowerCase();a=a.filter(e=>e.childName.toLowerCase().includes(t)||e.parentName.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.city.toLowerCase().includes(t)||e.interests.some(l=>l.toLowerCase().includes(t)))}this.filteredRequests=a}onSearchChange(){this.applyFilters()}onStatusChange(){this.applyFilters()}onAgeChange(){this.applyFilters()}onCreateRequest(){this.dialog.open(he,{width:"600px",maxWidth:"95vw",data:{latitude:60.9823,longitude:25.6551,city:"Lahti"}}).afterClosed().subscribe(t=>{})}onSendMessage(a){this.dialog.open(ve,{width:"500px",maxWidth:"95vw",data:{request:a}})}onProposePlaytime(a){this.dialog.open(be,{width:"600px",maxWidth:"95vw",data:{request:a}})}onEditRequest(a){alert("Muokkaus-toiminto tulossa pian!")}onDeleteRequest(a){this.friendRequestService.deleteFriendRequest(a.id).pipe(M(1)).subscribe({next:()=>{},error:t=>{console.error("Error deleting request:",t),alert("Ilmoituksen poisto ep\xE4onnistui. Yrit\xE4 uudelleen.")}})}onCloseRequest(a){this.friendRequestService.closeFriendRequest(a.id).pipe(M(1)).subscribe({next:()=>{},error:t=>{console.error("Error closing request:",t),alert("Ilmoituksen sulkeminen ep\xE4onnistui. Yrit\xE4 uudelleen.")}})}isOwner(a){return this.currentUserId!==null&&a.user_id===this.currentUserId}goBack(){this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||o)(h(O),h(Re),h(Ne),h(Ie))};static \u0275cmp=x({type:o,selectors:[["app-friend-request-table-page"]],decls:27,vars:7,consts:[[1,"table-page-container"],["class","loading-container",4,"ngIf"],["class","requests-container",4,"ngIf"],[1,"filters-section"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Etsi nimell\xE4, kiinnostuksilla, kaupungilla...",3,"ngModelChange","ngModel"],["matPrefix",""],["appearance","outline",1,"filter-field"],[3,"ngModelChange","ngModel"],["value","all"],["value","active"],["value","closed"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"loading-container"],[1,"requests-container"],["class","empty-state",4,"ngIf"],["class","requests-grid",4,"ngIf"],[1,"empty-state"],[4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],[1,"requests-grid"],[3,"request","isOwner","sendMessage","proposePlaytime","edit","delete","close",4,"ngFor","ngForOf"],[1,"create-card",3,"click"],[3,"sendMessage","proposePlaytime","edit","delete","close","request","isOwner"]],template:function(t,e){t&1&&(n(0,"div",0),c(1,At,2,0,"div",1)(2,Ht,3,2,"div",2),n(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),r(6,"Hae"),i(),n(7,"input",5),de("ngModelChange",function(m){return le(e.searchText,m)||(e.searchText=m),m}),u("ngModelChange",function(){return e.onSearchChange()}),i(),n(8,"mat-icon",6),r(9,"search"),i()(),n(10,"mat-form-field",7)(11,"mat-label"),r(12,"Tila"),i(),n(13,"mat-select",8),de("ngModelChange",function(m){return le(e.selectedStatus,m)||(e.selectedStatus=m),m}),u("ngModelChange",function(){return e.onStatusChange()}),n(14,"mat-option",9),r(15,"Kaikki"),i(),n(16,"mat-option",10),r(17,"Aktiiviset"),i(),n(18,"mat-option",11),r(19,"Ratkaistut"),i()()(),n(20,"mat-form-field",7)(21,"mat-label"),r(22,"Ik\xE4"),i(),n(23,"mat-select",8),de("ngModelChange",function(m){return le(e.selectedAge,m)||(e.selectedAge=m),m}),u("ngModelChange",function(){return e.onAgeChange()}),n(24,"mat-option",12),r(25,"Kaikki i\xE4t"),i(),c(26,$t,2,2,"mat-option",13),i()()()()),t&2&&(s(),d("ngIf",e.isLoading),s(),d("ngIf",!e.isLoading),s(5),se("ngModel",e.searchText),s(6),se("ngModel",e.selectedStatus),s(10),se("ngModel",e.selectedAge),s(),d("value",null),s(2),d("ngForOf",e.ageOptions))},dependencies:[S,k,E,Be,D,F,Le,P,q,j,B,R,I,w,je,V,T,ae,ce,me,Qe,Je,ue],styles:[".table-page-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f5f5f5;padding-bottom:100px;position:relative}.filters-section[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;background-color:#fff;padding:16px;box-shadow:0 -2px 8px #0000001a;z-index:100;max-width:1200px;margin:0 auto;display:flex;gap:16px;flex-wrap:wrap}.filters-section[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]{flex:1;min-width:250px}.filters-section[_ngcontent-%COMP%]   .filter-field[_ngcontent-%COMP%]{min-width:150px}@media (max-width: 768px){.filters-section[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%], .filters-section[_ngcontent-%COMP%]   .filter-field[_ngcontent-%COMP%]{width:100%;min-width:100%}}.fab-button[_ngcontent-%COMP%]{position:fixed;bottom:120px;right:24px;z-index:101}.fab-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}@media (max-width: 768px){.fab-button[_ngcontent-%COMP%]{bottom:140px;right:16px}}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px}.listings-container[_ngcontent-%COMP%]{padding:24px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 24px;text-align:center;color:#0009}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#0000004d;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:20px;color:#000000de}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 24px;font-size:14px}.empty-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:inline-flex!important;align-items:center!important}.empty-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;margin-right:8px;margin-bottom:0;vertical-align:middle;color:#fff}.requests-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:24px}.requests-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:24px;max-width:1200px}@media (min-width: 769px){.requests-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(max(250px,(100% - 72px) / 4),1fr))}}@media (max-width: 768px){.requests-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px}}.create-card[_ngcontent-%COMP%]{background-color:#fff;border:2px dashed #4CAF50;border-radius:8px;padding:48px 24px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;transition:all .3s ease;min-height:200px}.create-card[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#4caf50}.create-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#4caf50}.create-card[_ngcontent-%COMP%]:hover{background-color:#f1f8e9;border-color:#388e3c;transform:translateY(-2px);box-shadow:0 4px 12px #4caf5033}.create-card[_ngcontent-%COMP%]:hover   mat-icon[_ngcontent-%COMP%], .create-card[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:#388e3c}.create-card[_ngcontent-%COMP%]:active{transform:translateY(0)}"]})};export{rt as FriendRequestTablePageComponent};
