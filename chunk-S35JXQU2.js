import{a as S,b as T,c as D,d as V,e as N,f as A,g as G,h as z,i as $,j,k as L,l as R,m as H,n as B,o as K,p as Y,q as U,r as J,s as q,t as Q,u as W,v as X,w as x,x as Z,y as ee}from"./chunk-TSLVDBLJ.js";import{d as y,e as I,g as w,l as F,n as E}from"./chunk-4MKTNDPE.js";import{Gb as c,Hb as k,Ib as b,Na as s,Sa as C,Za as M,cb as f,ib as m,ja as p,ka as u,kb as v,qb as a,rb as o,sb as O,tb as h,vb as g,wb as l}from"./chunk-WLRQ2KVN.js";function oe(r,t){if(r&1){let e=h();a(0,"button",24),g("click",function(){let n=p(e).$implicit,d=l(2);return u(d.selectDate(n.value))}),c(1),o()}if(r&2){let e=t.$implicit,i=l(2);v("selected",i.selectedDate===e.value),s(),b(" ",e.label," ")}}function re(r,t){if(r&1&&(a(0,"mat-option",25),c(1),o()),r&2){let e=t.$implicit,i=l(2);m("value",e),s(),b(" ",i.getTimeLabel(e)," ")}}function ae(r,t){if(r&1){let e=h();a(0,"button",26),g("click",function(){let n=p(e).$implicit,d=l(2);return u(d.selectDuration(n.value))}),c(1),o()}if(r&2){let e=t.$implicit,i=l(2);v("selected",i.selectedDuration===e.value),s(),b(" ",e.label," ")}}function ce(r,t){if(r&1){let e=h();a(0,"button",35),g("click",function(){p(e);let n=l().index,d=l(2);return u(d.removeParticipant(n))}),c(1," \u2715 "),o()}}function le(r,t){if(r&1){let e=h();a(0,"button",36),g("click",function(){let n=p(e).$implicit,d=l().index,_=l(2);return u(_.selectAge(d,n))}),c(1),o()}if(r&2){let e=t.$implicit,i=l().$implicit;v("selected",i.childAge===e),s(),b(" ",e,"v ")}}function se(r,t){if(r&1){let e=h();a(0,"button",37),g("click",function(){let n=p(e).$implicit,d=l().index,_=l(2);return u(_.selectGender(d,n.value))}),a(1,"span",38),c(2),o(),a(3,"span",39),c(4),o()()}if(r&2){let e=t.$implicit,i=l().$implicit;v("selected",i.childGender===e.value),s(2),k(e.icon),s(2),k(e.label)}}function de(r,t){if(r&1){let e=h();a(0,"button",40),g("click",function(){p(e);let n=l().index,d=l(2);return u(d.removeGenderSelection(n))}),c(1," Poista valinta "),o()}}function me(r,t){if(r&1){let e=h();a(0,"button",41),g("click",function(){let n=p(e).$implicit,d=l().index,_=l(2);return u(_.toggleInterest(d,n.value))}),c(1),o()}if(r&2){let e=t.$implicit,i=l().index,n=l(2);v("selected",n.isInterestSelected(i,e.value)),s(),b(" ",e.label," ")}}function pe(r,t){r&1&&(a(0,"div",42),c(1," Valitse v\xE4hint\xE4\xE4n yksi kiinnostuksen kohde "),o())}function ue(r,t){if(r&1){let e=h();a(0,"button",43),g("click",function(){p(e);let n=l(3);return u(n.addParticipant())}),c(1," + Lis\xE4\xE4 osallistuja "),o()}}function fe(r,t){if(r&1&&(a(0,"fieldset",7)(1,"legend",8),c(2),f(3,ce,2,0,"button",27),o(),a(4,"div",11)(5,"label",12),c(6,"Lapsen ik\xE4"),o(),a(7,"div",13),f(8,le,2,3,"button",28),o()(),a(9,"div",11)(10,"label",12),c(11,"Sukupuoli (valinnainen)"),o(),a(12,"div",13),f(13,se,5,4,"button",29)(14,de,2,0,"button",30),o()(),a(15,"div",11)(16,"label",12),c(17,"Kiinnostuksen kohteet (valitse v\xE4hint\xE4\xE4n yksi)"),o(),a(18,"div",31),f(19,me,2,3,"button",32),o(),f(20,pe,2,0,"div",33),o(),f(21,ue,2,0,"button",34),o()),r&2){let e=t.$implicit,i=t.index,n=l(2);s(2),b(" ",n.getParticipantTitle(i)," "),s(),m("ngIf",n.participants.length>1),s(5),m("ngForOf",n.ageOptions),s(5),m("ngForOf",n.genderOptions),s(),m("ngIf",e.childGender!==null),s(5),m("ngForOf",n.availableInterests),s(),m("ngIf",n.submitted&&e.interests.length===0),s(),m("ngIf",i===n.participants.length-1&&n.isParticipantValid(i))}}function ge(r,t){if(r&1){let e=h();a(0,"div",1)(1,"div",2)(2,"button",3),g("click",function(){p(e);let n=l();return u(n.goBack())}),a(3,"span",4),c(4,"\u2190"),o(),c(5," Takaisin "),o(),a(6,"h1"),c(7,"\u{1F388} Leikkim\xE4\xE4n! \u{1F388}"),o()(),a(8,"div",5)(9,"form",6)(10,"fieldset",7)(11,"legend",8),c(12),o(),a(13,"mat-form-field",9)(14,"mat-label"),c(15,"Nimi (valinnainen)"),o(),O(16,"input",10),o(),a(17,"div",11)(18,"label",12),c(19,"P\xE4iv\xE4m\xE4\xE4r\xE4"),o(),a(20,"div",13),f(21,oe,2,3,"button",14),o()(),a(22,"div",11)(23,"label",12),c(24,"Kellonaika"),o(),a(25,"mat-form-field",15)(26,"mat-select",16),f(27,re,2,2,"mat-option",17),o()()(),a(28,"div",11)(29,"label",12),c(30,"Kesto"),o(),a(31,"div",13),f(32,ae,2,3,"button",18),o()(),a(33,"mat-form-field",15)(34,"mat-label"),c(35,"Lis\xE4tiedot (valinnainen)"),o(),O(36,"textarea",19),o()(),f(37,fe,22,8,"fieldset",20),o()(),a(38,"div",21)(39,"button",22),g("click",function(){p(e);let n=l();return u(n.goBack())}),c(40,"Peruuta"),o(),a(41,"button",23),g("click",function(){p(e);let n=l();return u(n.onSubmit())}),c(42," Leikkim\xE4\xE4n! "),o()()()}if(r&2){let e=l();s(9),m("formGroup",e.checkInForm),s(3),k(e.playground.name),s(9),m("ngForOf",e.dateOptions),s(6),m("ngForOf",e.timeOptions),s(5),m("ngForOf",e.durationOptions),s(5),m("ngForOf",e.participants),s(4),m("disabled",!e.checkInForm.valid||!e.areAllParticipantsValid())}}var te=class r{constructor(t,e,i,n,d){this.fb=t;this.route=e;this.router=i;this.checkInService=n;this.playgroundService=d;this.updateDateOptions(),this.updateTimeOptions(),this.checkInForm=this.fb.group({parentName:[""],scheduledTime:["now",T.required],additionalInfo:[""]})}checkInForm;playground=null;dateOptions=[];selectedDate="today";timeOptions=[];durationOptions=[{value:.5,label:"0,5h"},{value:1,label:"1h"},{value:1.5,label:"1,5h"},{value:2,label:"2h"}];selectedDuration=1;ageOptions=[0,1,2,3,4,5,6,7];genderOptions=[{value:"boy",icon:"\u{1F466}",label:"Poika"},{value:"girl",icon:"\u{1F467}",label:"Tytt\xF6"}];availableInterests=[{value:"jalkapallo",label:"Jalkapallo"},{value:"keinut",label:"Keinut"},{value:"liukum\xE4et",label:"Liukum\xE4et"},{value:"hiekkalaatikko",label:"Hiekkalaatikko"},{value:"kiipeily",label:"Kiipeily"},{value:"juokseminen",label:"Juokseminen"},{value:"py\xF6r\xE4ily",label:"Py\xF6r\xE4ily"},{value:"pallopelit",label:"Pallopelit"}];participants=[{childAge:3,childGender:null,interests:[]}];submitted=!1;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&this.playgroundService.getPlaygrounds().subscribe(e=>{this.playground=e.find(i=>i.id===t)||null})}roundToNearest15Minutes(t){let e=new Date(t),i=e.getMinutes(),n=Math.ceil(i/15)*15;return e.setMinutes(n),e.setSeconds(0),e.setMilliseconds(0),e}updateDateOptions(){this.dateOptions=[];let t=new Date;this.roundToNearest15Minutes(t).getHours()<=x.END_HOUR?this.dateOptions.push({value:"today",label:"T\xE4n\xE4\xE4n"}):this.selectedDate="tomorrow",this.dateOptions.push({value:"tomorrow",label:"Huomenna"})}updateTimeOptions(){this.timeOptions=[];let t=new Date,e=this.roundToNearest15Minutes(t),i=this.selectedDate==="today",n=i?e.getHours():x.START_HOUR,d=i?e.getMinutes():0;this.timeOptions.push("now");for(let _=n;_<=x.END_HOUR;_++){let ne=_===n?d:0;for(let P=ne;P<60;P+=x.INTERVAL_MINUTES){let ie=`${_.toString().padStart(2,"0")}:${P.toString().padStart(2,"0")}`;this.timeOptions.push(ie)}}}selectDate(t){this.selectedDate=t,this.updateTimeOptions(),this.checkInForm.patchValue({scheduledTime:"now"})}selectDuration(t){this.selectedDuration=t}selectAge(t,e){this.participants[t].childAge=e}selectGender(t,e){this.participants[t].childGender=e}removeGenderSelection(t){this.participants[t].childGender=null}toggleInterest(t,e){let i=this.participants[t].interests,n=i.indexOf(e);n>-1?i.splice(n,1):i.push(e)}isInterestSelected(t,e){return this.participants[t].interests.includes(e)}getTimeLabel(t){return t==="now"?"Nyt":t}getParticipantTitle(t){let e=this.participants[t],i=`${e.childAge}v`,n="lapsi";return e.childGender==="boy"?n="poika":e.childGender==="girl"&&(n="tytt\xF6"),`${i}-${n}`}isParticipantValid(t){return this.participants[t].interests.length>0}addParticipant(){this.participants.push({childAge:3,childGender:null,interests:[]})}removeParticipant(t){this.participants.length>1&&this.participants.splice(t,1)}areAllParticipantsValid(){return this.participants.every(t=>t.interests.length>0)}onSubmit(){this.submitted=!0;let t=this.participants.every(e=>e.interests.length>0);if(this.checkInForm.valid&&t&&this.playground){let e=this.checkInForm.value,i=this.calculateScheduledTime(),n={playgroundId:this.playground.id,parentName:e.parentName?.trim()||"Anonyymi",scheduledTime:i,duration:this.selectedDuration,participants:this.participants.map(d=>({childAge:d.childAge,childGender:d.childGender,interests:d.interests})),additionalInfo:e.additionalInfo||void 0};this.checkInService.createCheckIn(n).subscribe(()=>{this.router.navigate(["/playground",this.playground.id])})}}calculateScheduledTime(){let t=this.checkInForm.value.scheduledTime,e=new Date;if(this.selectedDate==="tomorrow"&&e.setDate(e.getDate()+1),t==="now")return this.roundToNearest15Minutes(new Date);let[i,n]=t.split(":").map(d=>parseInt(d,10));return e.setHours(i,n,0,0),e}goBack(){this.playground?this.router.navigate(["/playground",this.playground.id]):this.router.navigate(["/map"])}static \u0275fac=function(e){return new(e||r)(C(z),C(F),C(E),C(Z),C(ee))};static \u0275cmp=M({type:r,selectors:[["app-check-in-form-page"]],decls:1,vars:1,consts:[["class","form-page-container",4,"ngIf"],[1,"form-page-container"],[1,"form-page-header"],[1,"back-btn",3,"click"],[1,"back-icon"],[1,"form-page-content"],[1,"check-in-form",3,"formGroup"],[1,"form-fieldset"],[1,"fieldset-legend"],["appearance","outline","floatLabel","always",1,"full-width"],["matInput","","formControlName","parentName","placeholder","Voit j\xE4tt\xE4\xE4 tyhj\xE4ksi"],[1,"form-section"],[1,"section-label"],[1,"chip-row"],["type","button","class","selection-chip",3,"selected","click",4,"ngFor","ngForOf"],["appearance","outline",1,"full-width"],["formControlName","scheduledTime"],[3,"value",4,"ngFor","ngForOf"],["type","button","class","selection-chip duration-chip",3,"selected","click",4,"ngFor","ngForOf"],["matInput","","formControlName","additionalInfo","rows","3","placeholder","Esim. kuinka kauan oleskelette, mit\xE4 v\xE4lineit\xE4 otatte mukaan, jne."],["class","form-fieldset",4,"ngFor","ngForOf"],[1,"form-page-actions"],["mat-button","",1,"cancel-btn",3,"click"],["mat-raised-button","","color","primary",1,"submit-btn",3,"click","disabled"],["type","button",1,"selection-chip",3,"click"],[3,"value"],["type","button",1,"selection-chip","duration-chip",3,"click"],["type","button","class","remove-participant-btn",3,"click",4,"ngIf"],["type","button","class","selection-chip age-chip",3,"selected","click",4,"ngFor","ngForOf"],["type","button","class","selection-chip gender-chip",3,"selected","click",4,"ngFor","ngForOf"],["type","button","class","remove-selection-btn",3,"click",4,"ngIf"],[1,"interests-grid"],["type","button","class","interest-chip",3,"selected","click",4,"ngFor","ngForOf"],["class","error-message",4,"ngIf"],["type","button","class","add-participant-btn",3,"click",4,"ngIf"],["type","button",1,"remove-participant-btn",3,"click"],["type","button",1,"selection-chip","age-chip",3,"click"],["type","button",1,"selection-chip","gender-chip",3,"click"],[1,"icon"],[1,"label"],["type","button",1,"remove-selection-btn",3,"click"],["type","button",1,"interest-chip",3,"click"],[1,"error-message"],["type","button",1,"add-participant-btn",3,"click"]],template:function(e,i){e&1&&f(0,ge,43,7,"div",0),e&2&&m("ngIf",i.playground)},dependencies:[w,y,I,$,N,S,D,V,A,G,R,L,j,B,H,U,Y,K,q,J,Q,W,X],styles:[".form-page-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background:#fff}.form-page-header[_ngcontent-%COMP%]{position:sticky;top:0;background:#fff;border-bottom:1px solid #e0e0e0;padding:1rem;z-index:100;box-shadow:0 2px 4px #0000000d}.form-page-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1rem;color:#4caf50;cursor:pointer;padding:.5rem 0;margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem;font-weight:500}.form-page-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]   .back-icon[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1}.form-page-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover{color:#45a049}.form-page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;color:#333;text-align:center}.form-page-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.form-page-actions[_ngcontent-%COMP%]{position:sticky;bottom:0;background:#fff;border-top:1px solid #e0e0e0;padding:1rem 1.5rem;display:flex;justify-content:flex-end;gap:1rem;box-shadow:0 -2px 4px #0000000d}@media (max-width: 768px){.form-page-actions[_ngcontent-%COMP%]{padding:.75rem 1rem}.form-page-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}}.check-in-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;padding:0;width:100%;box-sizing:border-box}@media (max-width: 768px){.check-in-form[_ngcontent-%COMP%]{gap:1rem}}.form-fieldset[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;padding:1.5rem;margin:0;display:flex;flex-direction:column;gap:1.25rem;position:relative}.form-fieldset[_ngcontent-%COMP%]   .fieldset-legend[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#4caf50;padding:0 .5rem;margin-bottom:0;display:flex;align-items:center;gap:.75rem}.form-fieldset[_ngcontent-%COMP%]   .remove-participant-btn[_ngcontent-%COMP%]{background:#f44336;color:#fff;border:none;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.9rem;transition:all .2s ease;padding:0;line-height:1}.form-fieldset[_ngcontent-%COMP%]   .remove-participant-btn[_ngcontent-%COMP%]:hover{background:#d32f2f;transform:scale(1.1)}.form-fieldset[_ngcontent-%COMP%]   .add-participant-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:2px dashed #4CAF50;background:#fff;border-radius:8px;cursor:pointer;font-size:.95rem;font-weight:500;color:#4caf50;transition:all .2s ease;width:100%}.form-fieldset[_ngcontent-%COMP%]   .add-participant-btn[_ngcontent-%COMP%]:hover{background:#f1f8f4;border-style:solid;transform:translateY(-1px)}.form-section[_ngcontent-%COMP%]   .section-label[_ngcontent-%COMP%]{display:block;font-size:.9rem;font-weight:500;color:#666;margin-bottom:.75rem}.form-section[_ngcontent-%COMP%]   .chip-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.form-section[_ngcontent-%COMP%]   .selection-chip[_ngcontent-%COMP%]{padding:.6rem 1.2rem;border:2px solid #e0e0e0;background:#fff;border-radius:24px;cursor:pointer;font-size:.95rem;font-weight:500;transition:all .2s ease;color:#333}.form-section[_ngcontent-%COMP%]   .selection-chip[_ngcontent-%COMP%]:hover{border-color:#4caf50;background:#f1f8f4;transform:translateY(-1px)}.form-section[_ngcontent-%COMP%]   .selection-chip.selected[_ngcontent-%COMP%]{background:#4caf50;color:#fff;border-color:#4caf50;box-shadow:0 2px 4px #4caf504d}.form-section[_ngcontent-%COMP%]   .selection-chip.age-chip[_ngcontent-%COMP%]{min-width:50px;padding:.6rem .8rem}.form-section[_ngcontent-%COMP%]   .selection-chip.gender-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.form-section[_ngcontent-%COMP%]   .selection-chip.gender-chip[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:1.3rem}.form-section[_ngcontent-%COMP%]   .selection-chip.gender-chip[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.9rem}.form-section[_ngcontent-%COMP%]   .remove-selection-btn[_ngcontent-%COMP%]{padding:.6rem 1.2rem;border:2px solid #f44336;background:#fff;border-radius:24px;cursor:pointer;font-size:.9rem;color:#f44336;transition:all .2s ease}.form-section[_ngcontent-%COMP%]   .remove-selection-btn[_ngcontent-%COMP%]:hover{background:#ffebee;transform:translateY(-1px)}.form-section[_ngcontent-%COMP%]   .interests-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:.5rem}.form-section[_ngcontent-%COMP%]   .interest-chip[_ngcontent-%COMP%]{padding:.6rem 1rem;border:2px solid #e0e0e0;background:#fff;border-radius:20px;cursor:pointer;font-size:.9rem;transition:all .2s ease;text-align:center}.form-section[_ngcontent-%COMP%]   .interest-chip[_ngcontent-%COMP%]:hover{border-color:#4caf50;background:#f1f8f4;transform:translateY(-1px)}.form-section[_ngcontent-%COMP%]   .interest-chip.selected[_ngcontent-%COMP%]{background:#4caf50;color:#fff;border-color:#4caf50}.form-section[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:#f44336;font-size:.75rem;margin-top:.5rem}mat-form-field[_ngcontent-%COMP%]{width:100%;margin:0}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{background-color:#fff}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-select-value{color:#333;z-index:1;position:relative}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-select-trigger{background-color:#fff}mat-form-field[_ngcontent-%COMP%]     textarea.mat-mdc-input-element{resize:none;z-index:1;position:relative;background-color:#fff}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-input-element{background-color:#fff;color:#333;z-index:2;position:relative}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-input-element::placeholder{opacity:1;color:#0009}mat-form-field[_ngcontent-%COMP%]     input.mat-mdc-input-element{pointer-events:auto;cursor:text}mat-form-field[_ngcontent-%COMP%]     .mdc-notched-outline{background-color:#fff}mat-form-field[_ngcontent-%COMP%]     .mdc-notched-outline__leading, mat-form-field[_ngcontent-%COMP%]     .mdc-notched-outline__notch, mat-form-field[_ngcontent-%COMP%]     .mdc-notched-outline__trailing{background-color:#fff}.full-width[_ngcontent-%COMP%]{width:100%}@media (max-width: 768px){.form-page-header[_ngcontent-%COMP%]{padding:.75rem 1rem}.form-page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.form-page-content[_ngcontent-%COMP%]{padding:1rem}}"]})};export{te as CheckInFormPageComponent};
