import{a as Je,b as Qe}from"./chunk-UU5EPZBX.js";import{a as et,c as tt,e as it,f as nt,g as at}from"./chunk-X7HKXPJV.js";import{a as A,b as L}from"./chunk-V7E62WCL.js";import{a as Xe}from"./chunk-F7OEFYQI.js";import"./chunk-X5YLR3NI.js";import{A as T,B as V,C as ie,D as ne,E as ae,F as Ge,G as He,H as Ke,I as ce,J as We,K as $e,L as Ue,M as Ye,N as Ze,a as Ne,c as O,f as ze,h as D,i as v,j as I,k as $,l as Ae,m as U,n as Y,o as Z,p as J,q as Q,r as Le,s as X,t as F,u as ee,v as te,w as Be,x as je,y as w,z as R}from"./chunk-VUHFQXK3.js";import{a as B,b as j,c as Ve,d as G,e as H,f as K,g as W}from"./chunk-ZPVWGYEY.js";import"./chunk-CVMR7QOK.js";import{m as Re,o as S,p as Te,q as P}from"./chunk-A6Y66VFI.js";import"./chunk-JT74BPEB.js";import{Q as we,Z as xe,e as k,f as E,i as q,t as Fe}from"./chunk-T7AEDZSF.js";import{$ as Oe,$b as Ie,Bb as m,Db as be,I as M,Jb as n,Kb as i,Lb as y,Pb as b,Rb as u,Sb as p,ab as s,ac as r,bc as Ce,cc as g,dc as z,ec as le,fb as f,fc as me,gc as de,ma as _,mb as x,na as h,nb as De,sb as c,xa as N}from"./chunk-2ZS5FXWY.js";import"./chunk-ODN5LVDJ.js";var ot=(()=>{class a{static \u0275fac=function(t){return new(t||a)};static \u0275mod=De({type:a});static \u0275inj=Oe({imports:[we,xe,xe]})}return a})();function dt(a,o){a&1&&(n(0,"mat-chip",14),r(1," Ratkaistu "),i())}function ct(a,o){a&1&&(n(0,"mat-chip",15),r(1," Aktiivinen "),i())}function pt(a,o){if(a&1&&(n(0,"mat-chip",18),r(1),i()),a&2){let e=o.$implicit;s(),g(" ",e," ")}}function ut(a,o){if(a&1&&(n(0,"div",16)(1,"mat-chip-set"),c(2,pt,2,1,"mat-chip",17),i()()),a&2){let e=p();s(2),m("ngForOf",e.request.interests)}}function gt(a,o){if(a&1){let e=b();n(0,"a",19),u("click",function(){_(e);let l=p();return h(l.toggleDescription())}),r(1),i()}if(a&2){let e=p();s(),g(" ",e.showFullDescription?"N\xE4yt\xE4 v\xE4hemm\xE4n":"Lue lis\xE4\xE4"," ")}}function ft(a,o){if(a&1){let e=b();n(0,"div",20)(1,"button",21),u("click",function(){_(e);let l=p();return h(l.onSendMessage())}),n(2,"mat-icon"),r(3,"mail"),i(),r(4," L\xE4het\xE4 viesti "),i(),n(5,"button",22),u("click",function(){_(e);let l=p();return h(l.onProposePlaytime())}),n(6,"mat-icon"),r(7,"event"),i(),r(8," Ehdota leikkiaikaa "),i()()}}function _t(a,o){if(a&1){let e=b();n(0,"button",27),u("click",function(){_(e);let l=p(2);return h(l.onEdit())}),n(1,"mat-icon"),r(2,"edit"),i(),r(3," Muokkaa "),i()}}function ht(a,o){if(a&1){let e=b();n(0,"button",28),u("click",function(){_(e);let l=p(2);return h(l.onClose())}),n(1,"mat-icon"),r(2,"check_circle"),i(),r(3," Merkitse ratkaistuksi "),i()}}function vt(a,o){if(a&1){let e=b();n(0,"div",23),c(1,_t,4,0,"button",24)(2,ht,4,0,"button",25),n(3,"button",26),u("click",function(){_(e);let l=p();return h(l.onDelete())}),n(4,"mat-icon"),r(5,"delete"),i(),r(6," Poista "),i()()}if(a&2){let e=p();s(),m("ngIf",e.request.status==="active"),s(),m("ngIf",e.request.status==="active")}}var pe=class a{request;isOwner=!1;sendMessage=new N;proposePlaytime=new N;edit=new N;delete=new N;close=new N;showFullDescription=!1;get isLongDescription(){return this.request.description.length>150}get displayDescription(){return this.showFullDescription||!this.isLongDescription?this.request.description:this.request.description.substring(0,150)+"..."}toggleDescription(){this.showFullDescription=!this.showFullDescription}onSendMessage(){this.sendMessage.emit(this.request)}onProposePlaytime(){this.proposePlaytime.emit(this.request)}onEdit(){this.edit.emit(this.request)}onDelete(){confirm("Haluatko varmasti poistaa t\xE4m\xE4n ilmoituksen?")&&this.delete.emit(this.request)}onClose(){confirm("Haluatko merkit\xE4 ilmoituksen ratkaistuksi?")&&this.close.emit(this.request)}getRelativeTime(){let o=new Date,e=new Date(this.request.createdAt),t=o.getTime()-e.getTime(),l=Math.floor(t/6e4),d=Math.floor(l/60),C=Math.floor(d/24);return l<60?`${l} minuuttia sitten`:d<24?`${d} tuntia sitten`:C<7?`${C} p\xE4iv\xE4\xE4 sitten`:e.toLocaleDateString("fi-FI")}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=x({type:a,selectors:[["app-friend-request-card"]],inputs:{request:"request",isOwner:"isOwner"},outputs:{sendMessage:"sendMessage",proposePlaytime:"proposePlaytime",edit:"edit",delete:"delete",close:"close"},decls:28,vars:14,consts:[[1,"friend-request-card"],[1,"card-header-content"],[1,"child-info"],[1,"child-name"],[1,"parent-name"],["class","status-chip closed",4,"ngIf"],["class","status-chip active",4,"ngIf"],["class","interests-section",4,"ngIf"],[1,"description"],["class","read-more-link",3,"click",4,"ngIf"],[1,"location"],[1,"created-date"],["class","public-actions",4,"ngIf"],["class","owner-actions",4,"ngIf"],[1,"status-chip","closed"],[1,"status-chip","active"],[1,"interests-section"],["class","interest-chip",4,"ngFor","ngForOf"],[1,"interest-chip"],[1,"read-more-link",3,"click"],[1,"public-actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"owner-actions"],["mat-button","",3,"click",4,"ngIf"],["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","","color","warn",3,"click"],["mat-button","",3,"click"],["mat-button","","color","primary",3,"click"]],template:function(e,t){e&1&&(n(0,"mat-card",0)(1,"mat-card-header")(2,"div",1)(3,"div",2)(4,"h3",3),r(5),i(),n(6,"span",4),r(7),i()(),c(8,dt,2,0,"mat-chip",5)(9,ct,2,0,"mat-chip",6),i()(),n(10,"mat-card-content"),c(11,ut,3,1,"div",7),n(12,"p",8),r(13),c(14,gt,2,1,"a",9),i(),n(15,"div",10)(16,"mat-icon"),r(17,"location_on"),i(),n(18,"span"),r(19),i()(),n(20,"div",11)(21,"mat-icon"),r(22,"schedule"),i(),n(23,"span"),r(24),i()()(),n(25,"mat-card-actions"),c(26,ft,9,0,"div",12)(27,vt,7,2,"div",13),i()()),e&2&&(be("closed",t.request.status==="closed"),s(5),z("",t.request.childName,", ",t.request.childAge," v"),s(2),g("Vanhempi: ",t.request.parentName,""),s(),m("ngIf",t.request.status==="closed"),s(),m("ngIf",t.request.status==="active"),s(2),m("ngIf",t.request.interests&&t.request.interests.length>0),s(2),g(" ",t.displayDescription," "),s(),m("ngIf",t.isLongDescription),s(5),Ce(t.request.city),s(5),Ce(t.getRelativeTime()),s(2),m("ngIf",!t.isOwner&&t.request.status==="active"),s(),m("ngIf",t.isOwner))},dependencies:[q,k,E,at,et,it,tt,nt,P,S,L,A,ce,Ge,Ke,ot],styles:[".friend-listing-card[_ngcontent-%COMP%]{margin-bottom:16px;transition:all .3s ease}.friend-listing-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #00000026}.friend-listing-card.closed[_ngcontent-%COMP%]{opacity:.7;background-color:#f5f5f5}.card-header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;width:100%;gap:16px}.child-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;flex:1}.child-info[_ngcontent-%COMP%]   .child-name[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;color:#673ab7}.child-info[_ngcontent-%COMP%]   .parent-name[_ngcontent-%COMP%]{font-size:14px;color:#0009}.status-chip.active[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important}.status-chip.closed[_ngcontent-%COMP%]{background-color:#9e9e9e!important;color:#fff!important}mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding-top:16px}.interests-section[_ngcontent-%COMP%]   mat-chip-set[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.interests-section[_ngcontent-%COMP%]   .interest-chip[_ngcontent-%COMP%]{background-color:#673ab71a;color:#673ab7;font-size:12px}.description[_ngcontent-%COMP%]{margin:0;line-height:1.6;color:#000000de;white-space:pre-wrap;word-wrap:break-word}.description[_ngcontent-%COMP%]   .read-more-link[_ngcontent-%COMP%]{color:#673ab7;cursor:pointer;text-decoration:none;margin-left:4px;font-weight:500}.description[_ngcontent-%COMP%]   .read-more-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.location[_ngcontent-%COMP%], .created-date[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:14px;color:#0009}.location[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .created-date[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:#673ab7}mat-card-actions[_ngcontent-%COMP%]{padding:16px;display:flex;justify-content:flex-end}mat-card-actions[_ngcontent-%COMP%]   .public-actions[_ngcontent-%COMP%], mat-card-actions[_ngcontent-%COMP%]   .owner-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px;font-size:18px;width:18px;height:18px}@media (max-width: 768px){.card-header-content[_ngcontent-%COMP%]{flex-direction:column}mat-card-actions[_ngcontent-%COMP%]   .public-actions[_ngcontent-%COMP%], mat-card-actions[_ngcontent-%COMP%]   .owner-actions[_ngcontent-%COMP%]{width:100%;flex-direction:column}mat-card-actions[_ngcontent-%COMP%]   .public-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], mat-card-actions[_ngcontent-%COMP%]   .owner-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})};function bt(a,o){a&1&&(n(0,"mat-error"),r(1," Lapsen nimi on pakollinen "),i())}function Ct(a,o){a&1&&(n(0,"mat-error"),r(1," Nimi voi olla enint\xE4\xE4n 255 merkki\xE4 "),i())}function xt(a,o){if(a&1&&(n(0,"mat-option",17),r(1),i()),a&2){let e=o.$implicit;m("value",e),s(),g(" ",e," vuotta ")}}function Mt(a,o){a&1&&(n(0,"mat-error"),r(1," Valitse lapsen ik\xE4 "),i())}function yt(a,o){if(a&1){let e=b();n(0,"mat-chip-option",18),u("click",function(){let l=_(e).$implicit,d=p();return h(d.toggleInterest(l))}),r(1),i()}if(a&2){let e=o.$implicit,t=p();m("selected",t.isInterestSelected(e)),s(),g(" ",e," ")}}function Et(a,o){a&1&&(n(0,"div",19),r(1," Valitse v\xE4hint\xE4\xE4n yksi kiinnostuksen kohde "),i())}function qt(a,o){a&1&&(n(0,"mat-error"),r(1," Kuvaus on pakollinen "),i())}function St(a,o){a&1&&(n(0,"mat-error"),r(1," Kuvaus voi olla enint\xE4\xE4n 500 merkki\xE4 "),i())}var _e=class a{constructor(o,e,t,l){this.fb=o;this.friendRequestService=e;this.dialogRef=t;this.data=l}form;isSubmitting=!1;availableInterests=["Jalkapallo","Keinut","Liukum\xE4et","Hiekkalaatikko","Kiipeily","Juokseminen","Py\xF6r\xE4ily","Pallopelit","Piirt\xE4minen","Ulkoilu","El\xE4imet"];selectedInterests=[];ageOptions=[0,1,2,3,4,5,6,7];ngOnInit(){this.form=this.fb.group({childName:["",[v.required,v.maxLength(255)]],childAge:["",[v.required]],description:["",[v.required,v.maxLength(500)]]})}toggleInterest(o){let e=this.selectedInterests.indexOf(o);e>=0?this.selectedInterests.splice(e,1):this.selectedInterests.push(o)}isInterestSelected(o){return this.selectedInterests.includes(o)}onSubmit(){if(this.form.invalid||this.selectedInterests.length===0||this.isSubmitting)return;this.isSubmitting=!0;let o={parentName:"Vanhempi",childName:this.form.value.childName,childAge:this.form.value.childAge,description:this.form.value.description,interests:this.selectedInterests,latitude:this.data.latitude,longitude:this.data.longitude,city:this.data.city};console.log("Creating friend request with DTO:",o),this.friendRequestService.createFriendRequest(o).pipe(M(1)).subscribe({next:e=>{console.log("Friend request created successfully:",e),this.dialogRef.close(e)},error:e=>{console.error("Error creating friend request:",e),console.error("Error details:",e.error);let t="Kaverihakuilmoituksen luominen ep\xE4onnistui.";e.status===401?t="Kirjaudu sis\xE4\xE4n luodaksesi ilmoituksen.":e.error?.message&&(t=e.error.message),alert(t+" Yrit\xE4 uudelleen."),this.isSubmitting=!1}})}onCancel(){this.dialogRef.close()}get remainingChars(){return 500-(this.form.get("description")?.value||"").length}static \u0275fac=function(e){return new(e||a)(f(Q),f(O),f(B),f(j))};static \u0275cmp=x({type:a,selectors:[["app-friend-request-create-dialog"]],decls:40,vars:14,consts:[["mat-dialog-title",""],[1,"friend-request-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","childName","placeholder","Esim. Emma","required",""],[4,"ngIf"],["formControlName","childAge","required",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-section"],[1,"section-label"],[1,"interests-chips"],["class","interest-chip",3,"selected","click",4,"ngFor","ngForOf"],["class","hint","style","color: #f44336; font-size: 12px; margin-top: 4px;",4,"ngIf"],["matInput","","formControlName","description","rows","6","placeholder","Kerro lapsestasi ja mit\xE4 etsitte. Esim. erityistarpeet, toiveet leikkikaverin suhteen...","required",""],["align","end"],[1,"location-info"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],[3,"value"],[1,"interest-chip",3,"click","selected"],[1,"hint",2,"color","#f44336","font-size","12px","margin-top","4px"]],template:function(e,t){if(e&1&&(n(0,"h2",0),r(1,"Luo kaverihakuilmoitus"),i(),n(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),r(6,"Lapsen nimi"),i(),y(7,"input",3),c(8,bt,2,0,"mat-error",4)(9,Ct,2,0,"mat-error",4),i(),n(10,"mat-form-field",2)(11,"mat-label"),r(12,"Lapsen ik\xE4"),i(),n(13,"mat-select",5),c(14,xt,2,2,"mat-option",6),i(),c(15,Mt,2,0,"mat-error",4),i(),n(16,"div",7)(17,"label",8),r(18,"Kiinnostuksen kohteet *"),i(),n(19,"div",9),c(20,yt,2,2,"mat-chip-option",10),i(),c(21,Et,2,0,"div",11),i(),n(22,"mat-form-field",2)(23,"mat-label"),r(24,"Kuvaus"),i(),y(25,"textarea",12),n(26,"mat-hint",13),r(27),i(),c(28,qt,2,0,"mat-error",4)(29,St,2,0,"mat-error",4),i(),n(30,"div",14)(31,"mat-icon"),r(32,"location_on"),i(),n(33,"span"),r(34),i()()()(),n(35,"mat-dialog-actions",13)(36,"button",15),u("click",function(){return t.onCancel()}),r(37," Peruuta "),i(),n(38,"button",16),u("click",function(){return t.onSubmit()}),r(39),i()()),e&2){let l,d,C,oe,re;s(3),m("formGroup",t.form),s(5),m("ngIf",(l=t.form.get("childName"))==null?null:l.hasError("required")),s(),m("ngIf",(d=t.form.get("childName"))==null?null:d.hasError("maxlength")),s(5),m("ngForOf",t.ageOptions),s(),m("ngIf",(C=t.form.get("childAge"))==null?null:C.hasError("required")),s(5),m("ngForOf",t.availableInterests),s(),m("ngIf",t.selectedInterests.length===0),s(6),g("",t.remainingChars," / 500 merkki\xE4 j\xE4ljell\xE4"),s(),m("ngIf",(oe=t.form.get("description"))==null?null:oe.hasError("required")),s(),m("ngIf",(re=t.form.get("description"))==null?null:re.hasError("maxlength")),s(5),g("Sijainti: ",t.data.city,""),s(2),m("disabled",t.isSubmitting),s(2),m("disabled",t.form.invalid||t.selectedInterests.length===0||t.isSubmitting),s(),g(" ",t.isSubmitting?"Luodaan...":"Luo ilmoitus"," ")}},dependencies:[q,k,E,X,U,D,I,$,J,Y,Z,W,G,K,H,P,S,R,w,F,te,ee,V,T,ae,ne,ie,ce,He,L,A],styles:[".friend-listing-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;min-width:400px;padding:16px 0}@media (max-width: 768px){.friend-listing-form[_ngcontent-%COMP%]{min-width:280px}}.full-width[_ngcontent-%COMP%]{width:100%}.form-section[_ngcontent-%COMP%]{margin-bottom:16px}.form-section[_ngcontent-%COMP%]   .section-label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;color:#000000de;margin-bottom:12px}.interests-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.interests-chips[_ngcontent-%COMP%]   .interest-chip[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}.interests-chips[_ngcontent-%COMP%]   .interest-chip[_ngcontent-%COMP%]:hover{background-color:#673ab71a}.location-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px;background-color:#673ab70d;border-radius:4px;color:#0009}.location-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#673ab7}mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px}"]})};function Pt(a,o){a&1&&(n(0,"mat-error"),r(1," Viesti on pakollinen "),i())}function kt(a,o){a&1&&(n(0,"mat-error"),r(1," Viesti voi olla enint\xE4\xE4n 300 merkki\xE4 "),i())}var he=class a{constructor(o,e,t,l){this.fb=o;this.friendRequestService=e;this.dialogRef=t;this.data=l}form;isSubmitting=!1;ngOnInit(){this.form=this.fb.group({message:["",[v.required,v.maxLength(300)]]})}onSubmit(){if(this.form.invalid||this.isSubmitting)return;this.isSubmitting=!0;let o={requestId:this.data.request.id,message:this.form.value.message};this.friendRequestService.sendMessage(o).pipe(M(1)).subscribe({next:()=>{alert("Viesti l\xE4hetetty onnistuneesti! Ilmoituksen luoja saa sen s\xE4hk\xF6postiinsa."),this.dialogRef.close(!0)},error:e=>{console.error("Error sending message:",e),alert("Viestin l\xE4hett\xE4minen ep\xE4onnistui. Yrit\xE4 uudelleen."),this.isSubmitting=!1}})}onCancel(){this.dialogRef.close()}get remainingChars(){return 300-(this.form.get("message")?.value||"").length}static \u0275fac=function(e){return new(e||a)(f(Q),f(O),f(B),f(j))};static \u0275cmp=x({type:a,selectors:[["app-send-message-dialog"]],decls:25,vars:10,consts:[["mat-dialog-title",""],[1,"request-info"],[1,"message-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","message","rows","8","placeholder","Hei! Meill\xE4 on my\xF6s sammanik\xE4inen lapsi. Haluaisitko jutella lis\xE4\xE4 ja sopia yhteisest\xE4 leikkiajasta?","required",""],["align","end"],[4,"ngIf"],[1,"info-box"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(e,t){if(e&1&&(n(0,"h2",0),r(1,"L\xE4het\xE4 viesti"),i(),n(2,"mat-dialog-content")(3,"div",1)(4,"h3"),r(5),i(),n(6,"p"),r(7),i()(),n(8,"form",2)(9,"mat-form-field",3)(10,"mat-label"),r(11,"Viestisi"),i(),y(12,"textarea",4),n(13,"mat-hint",5),r(14),i(),c(15,Pt,2,0,"mat-error",6)(16,kt,2,0,"mat-error",6),i(),n(17,"div",7)(18,"p"),r(19,"\u{1F4A1} Vinkki: Kerro lyhyesti lapsestasi ja miksi otit yhteytt\xE4. Ilmoituksen luoja saa viestisi s\xE4hk\xF6postiinsa."),i()()()(),n(20,"mat-dialog-actions",5)(21,"button",8),u("click",function(){return t.onCancel()}),r(22," Peruuta "),i(),n(23,"button",9),u("click",function(){return t.onSubmit()}),r(24),i()()),e&2){let l,d;s(5),z("",t.data.request.childName,", ",t.data.request.childAge," v"),s(2),g("Vanhempi: ",t.data.request.parentName,""),s(),m("formGroup",t.form),s(6),g("",t.remainingChars," / 300 merkki\xE4 j\xE4ljell\xE4"),s(),m("ngIf",(l=t.form.get("message"))==null?null:l.hasError("required")),s(),m("ngIf",(d=t.form.get("message"))==null?null:d.hasError("maxlength")),s(5),m("disabled",t.isSubmitting),s(2),m("disabled",t.form.invalid||t.isSubmitting),s(),g(" ",t.isSubmitting?"L\xE4hetet\xE4\xE4n...":"L\xE4het\xE4 viesti"," ")}},dependencies:[q,E,X,U,D,I,$,J,Y,Z,W,G,K,H,P,S,R,w,F,te,ee,V,T],styles:[".listing-info[_ngcontent-%COMP%]{background-color:#673ab70d;padding:16px;border-radius:4px;margin-bottom:24px}.listing-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#673ab7;font-size:18px;font-weight:600}.listing-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#0009;font-size:14px}.message-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.info-box[_ngcontent-%COMP%]{background-color:#e8f5e9;border-left:4px solid #4caf50;padding:12px 16px;border-radius:4px}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.5;color:#000c}mat-dialog-content[_ngcontent-%COMP%]{min-width:400px;max-height:70vh;overflow-y:auto}@media (max-width: 768px){mat-dialog-content[_ngcontent-%COMP%]{min-width:280px}}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px}"]})};function Ot(a,o){if(a&1&&(n(0,"div",18)(1,"strong"),r(2,"Kiinnostukset:"),i(),r(3),i()),a&2){let e=p();s(3),g(" ",e.data.request.interests.join(", ")," ")}}function Dt(a,o){if(a&1&&(n(0,"mat-option",19),r(1),i()),a&2){let e=o.$implicit;m("value",e.id),s(),g(" ",e.name," ")}}function It(a,o){a&1&&(n(0,"mat-error"),r(1," Valitse leikkipuisto "),i())}function Ft(a,o){a&1&&(n(0,"mat-error"),r(1," Valitse p\xE4iv\xE4m\xE4\xE4r\xE4 "),i())}function wt(a,o){if(a&1&&(n(0,"mat-option",19),r(1),i()),a&2){let e=o.$implicit;m("value",e),s(),g(" ",e," ")}}function Rt(a,o){a&1&&(n(0,"mat-error"),r(1," Valitse kellonaika "),i())}function Tt(a,o){if(a&1&&(n(0,"mat-option",19),r(1),i()),a&2){let e=o.$implicit;m("value",e),s(),g(" ",e," h ")}}function Vt(a,o){a&1&&(n(0,"mat-error"),r(1," Valitse kesto "),i())}function Nt(a,o){a&1&&(n(0,"mat-error"),r(1," Viesti on pakollinen "),i())}function zt(a,o){a&1&&(n(0,"mat-error"),r(1," Viesti voi olla enint\xE4\xE4n 300 merkki\xE4 "),i())}var ve=class a{constructor(o,e,t,l,d){this.fb=o;this.friendRequestService=e;this.playgroundService=t;this.dialogRef=l;this.data=d}form;isSubmitting=!1;playgrounds=[];timeSlots=[];durationOptions=[.5,1,1.5,2];minDate=new Date;ngOnInit(){this.timeSlots=ze(),this.form=this.fb.group({playgroundId:["",v.required],date:["",v.required],time:["",v.required],duration:[1,v.required],message:["",[v.required,v.maxLength(300)]]}),this.playgroundService.getPlaygrounds().pipe(M(1)).subscribe(o=>{this.playgrounds=o})}onSubmit(){if(this.form.invalid||this.isSubmitting)return;this.isSubmitting=!0;let o=this.form.value,e=this.playgrounds.find(C=>C.id===o.playgroundId);if(!e){alert("Valitse leikkipuisto"),this.isSubmitting=!1;return}let l=new Date(o.date).toISOString().split("T")[0],d={requestId:this.data.request.id,message:o.message,playtimeDetails:{date:l,time:o.time,location:e.name,duration:o.duration,notes:""}};this.friendRequestService.proposePlaytime(d).pipe(M(1)).subscribe({next:()=>{alert("Leikkiaika-ehdotus l\xE4hetetty onnistuneesti! Ilmoituksen luoja saa sen s\xE4hk\xF6postiinsa."),this.dialogRef.close(!0)},error:C=>{console.error("Error proposing playtime:",C),alert("Ehdotuksen l\xE4hett\xE4minen ep\xE4onnistui. Yrit\xE4 uudelleen."),this.isSubmitting=!1}})}onCancel(){this.dialogRef.close()}get remainingChars(){return 300-(this.form.get("message")?.value||"").length}static \u0275fac=function(e){return new(e||a)(f(Q),f(O),f(Ne),f(B),f(j))};static \u0275cmp=x({type:a,selectors:[["app-propose-playtime-dialog"]],decls:52,vars:21,consts:[["picker",""],["mat-dialog-title",""],[1,"request-info"],["class","interests",4,"ngIf"],[1,"playtime-form",3,"formGroup"],["appearance","outline",1,"full-width"],["formControlName","playgroundId","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","formControlName","date","placeholder","Valitse p\xE4iv\xE4","required","",3,"matDatepicker","min"],["matSuffix","",3,"for"],["formControlName","time","required",""],["formControlName","duration","required",""],["matInput","","formControlName","message","rows","5","placeholder","Haluaisitko tulla leikkim\xE4\xE4n huomenna? Voimme sopia tarkemman ajan!","required",""],["align","end"],[1,"info-box"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"interests"],[3,"value"]],template:function(e,t){if(e&1){let l=b();n(0,"h2",1),r(1,"Ehdota leikkiaikaa"),i(),n(2,"mat-dialog-content")(3,"div",2)(4,"h3"),r(5),i(),n(6,"p"),r(7),i(),c(8,Ot,4,1,"div",3),i(),n(9,"form",4)(10,"mat-form-field",5)(11,"mat-label"),r(12,"Leikkipuisto"),i(),n(13,"mat-select",6),c(14,Dt,2,2,"mat-option",7),i(),c(15,It,2,0,"mat-error",8),i(),n(16,"mat-form-field",5)(17,"mat-label"),r(18,"P\xE4iv\xE4m\xE4\xE4r\xE4"),i(),y(19,"input",9)(20,"mat-datepicker-toggle",10)(21,"mat-datepicker",null,0),c(23,Ft,2,0,"mat-error",8),i(),n(24,"mat-form-field",5)(25,"mat-label"),r(26,"Kellonaika"),i(),n(27,"mat-select",11),c(28,wt,2,2,"mat-option",7),i(),c(29,Rt,2,0,"mat-error",8),i(),n(30,"mat-form-field",5)(31,"mat-label"),r(32,"Kesto"),i(),n(33,"mat-select",12),c(34,Tt,2,2,"mat-option",7),i(),c(35,Vt,2,0,"mat-error",8),i(),n(36,"mat-form-field",5)(37,"mat-label"),r(38,"Viestisi"),i(),y(39,"textarea",13),n(40,"mat-hint",14),r(41),i(),c(42,Nt,2,0,"mat-error",8)(43,zt,2,0,"mat-error",8),i(),n(44,"div",15)(45,"p"),r(46,"\u{1F4A1} Ehdotettu aika on alustava. Voitte sopia tarkan ajan yhdess\xE4 viestien kautta."),i()()()(),n(47,"mat-dialog-actions",14)(48,"button",16),u("click",function(){return _(l),h(t.onCancel())}),r(49," Peruuta "),i(),n(50,"button",17),u("click",function(){return _(l),h(t.onSubmit())}),r(51),i()()}if(e&2){let l,d,C,oe,re,Pe,ke=Ie(22);s(5),z("",t.data.request.childName,", ",t.data.request.childAge," v"),s(2),g("Vanhempi: ",t.data.request.parentName,""),s(),m("ngIf",t.data.request.interests&&t.data.request.interests.length>0),s(),m("formGroup",t.form),s(5),m("ngForOf",t.playgrounds),s(),m("ngIf",(l=t.form.get("playgroundId"))==null?null:l.hasError("required")),s(4),m("matDatepicker",ke)("min",t.minDate),s(),m("for",ke),s(3),m("ngIf",(d=t.form.get("date"))==null?null:d.hasError("required")),s(5),m("ngForOf",t.timeSlots),s(),m("ngIf",(C=t.form.get("time"))==null?null:C.hasError("required")),s(5),m("ngForOf",t.durationOptions),s(),m("ngIf",(oe=t.form.get("duration"))==null?null:oe.hasError("required")),s(6),g("",t.remainingChars," / 300 merkki\xE4 j\xE4ljell\xE4"),s(),m("ngIf",(re=t.form.get("message"))==null?null:re.hasError("required")),s(),m("ngIf",(Pe=t.form.get("message"))==null?null:Pe.hasError("maxlength")),s(5),m("disabled",t.isSubmitting),s(2),m("disabled",t.form.invalid||t.isSubmitting),s(),g(" ",t.isSubmitting?"L\xE4hetet\xE4\xE4n...":"L\xE4het\xE4 ehdotus"," ")}},dependencies:[q,k,E,X,U,D,I,$,J,Y,Z,W,G,K,H,P,S,R,w,F,te,ee,je,V,T,Ye,We,$e,Ue,Ze,ae,ne,ie],styles:[".listing-info[_ngcontent-%COMP%]{background-color:#673ab70d;padding:16px;border-radius:4px;margin-bottom:24px}.listing-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#673ab7;font-size:18px;font-weight:600}.listing-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;color:#0009;font-size:14px}.listing-info[_ngcontent-%COMP%]   .interests[_ngcontent-%COMP%]{font-size:14px;color:#000c;margin-top:8px}.listing-info[_ngcontent-%COMP%]   .interests[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#673ab7}.playtime-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.info-box[_ngcontent-%COMP%]{background-color:#fff3e0;border-left:4px solid #ff9800;padding:12px 16px;border-radius:4px}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.5;color:#000c}mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;max-height:70vh;overflow-y:auto}@media (max-width: 768px){mat-dialog-content[_ngcontent-%COMP%]{min-width:280px}}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px}"]})};function At(a,o){if(a&1&&(n(0,"mat-option",13),r(1),i()),a&2){let e=o.$implicit;m("value",e),s(),g(" ",e," vuotta ")}}function Lt(a,o){a&1&&(n(0,"div",17),y(1,"mat-spinner"),i())}function Bt(a,o){a&1&&(n(0,"p"),r(1," Kokeile muuttaa hakuehtoja. "),i())}function jt(a,o){a&1&&(n(0,"p"),r(1," Ole ensimm\xE4inen ja luo ilmoitus! "),i())}function Gt(a,o){if(a&1){let e=b();n(0,"div",21)(1,"mat-icon"),r(2,"inbox"),i(),n(3,"h3"),r(4,"Ei ilmoituksia"),i(),c(5,Bt,2,0,"p",22)(6,jt,2,0,"p",22),n(7,"button",23),u("click",function(){_(e);let l=p(2);return h(l.onCreateRequest())}),n(8,"mat-icon"),r(9,"add"),i(),r(10," Luo ilmoitus "),i()()}if(a&2){let e=p(2);s(5),m("ngIf",e.searchText||e.selectedAge!==null),s(),m("ngIf",!e.searchText&&e.selectedAge===null)}}function Ht(a,o){if(a&1){let e=b();n(0,"app-friend-request-card",26),u("sendMessage",function(l){_(e);let d=p(3);return h(d.onSendMessage(l))})("proposePlaytime",function(l){_(e);let d=p(3);return h(d.onProposePlaytime(l))})("edit",function(l){_(e);let d=p(3);return h(d.onEditRequest(l))})("delete",function(l){_(e);let d=p(3);return h(d.onDeleteRequest(l))})("close",function(l){_(e);let d=p(3);return h(d.onCloseRequest(l))}),i()}if(a&2){let e=o.$implicit,t=p(3);m("request",e)("isOwner",t.isOwner(e))}}function Kt(a,o){if(a&1&&(n(0,"div",24),c(1,Ht,1,2,"app-friend-request-card",25),i()),a&2){let e=p(2);s(),m("ngForOf",e.filteredRequests)}}function Wt(a,o){if(a&1&&(n(0,"div",18),c(1,Gt,11,2,"div",19)(2,Kt,2,1,"div",20),i()),a&2){let e=p();s(),m("ngIf",e.filteredRequests.length===0),s(),m("ngIf",e.filteredRequests.length>0)}}var lt=class a{constructor(o,e,t,l){this.friendRequestService=o;this.supabaseService=e;this.dialog=t;this.router=l}requests=[];filteredRequests=[];isLoading=!0;currentUserId=null;searchText="";selectedStatus="active";selectedAge=null;requestsSubscription;ageOptions=[0,1,2,3,4,5,6,7];ngOnInit(){let o=this.supabaseService.getSession();this.currentUserId=o?.user?.id||null,this.requestsSubscription=this.friendRequestService.getAllRequests().subscribe(e=>{this.requests=e,this.applyFilters(),this.isLoading=!1})}ngOnDestroy(){this.requestsSubscription?.unsubscribe()}applyFilters(){let o=[...this.requests];if(this.selectedStatus!=="all"&&(o=o.filter(e=>e.status===this.selectedStatus)),this.selectedAge!==null&&(o=o.filter(e=>e.childAge===this.selectedAge)),this.searchText.trim()){let e=this.searchText.toLowerCase();o=o.filter(t=>t.childName.toLowerCase().includes(e)||t.parentName.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.city.toLowerCase().includes(e)||t.interests.some(l=>l.toLowerCase().includes(e)))}this.filteredRequests=o}onSearchChange(){this.applyFilters()}onStatusChange(){this.applyFilters()}onAgeChange(){this.applyFilters()}onCreateRequest(){this.dialog.open(_e,{width:"600px",maxWidth:"95vw",data:{latitude:60.9823,longitude:25.6551,city:"Lahti"}}).afterClosed().subscribe(e=>{})}onSendMessage(o){this.dialog.open(he,{width:"500px",maxWidth:"95vw",data:{request:o}})}onProposePlaytime(o){this.dialog.open(ve,{width:"600px",maxWidth:"95vw",data:{request:o}})}onEditRequest(o){alert("Muokkaus-toiminto tulossa pian!")}onDeleteRequest(o){this.friendRequestService.deleteFriendRequest(o.id).pipe(M(1)).subscribe({next:()=>{},error:e=>{console.error("Error deleting request:",e),alert("Ilmoituksen poisto ep\xE4onnistui. Yrit\xE4 uudelleen.")}})}onCloseRequest(o){this.friendRequestService.closeFriendRequest(o.id).pipe(M(1)).subscribe({next:()=>{},error:e=>{console.error("Error closing request:",e),alert("Ilmoituksen sulkeminen ep\xE4onnistui. Yrit\xE4 uudelleen.")}})}isOwner(o){return this.currentUserId!==null&&o.user_id===this.currentUserId}goBack(){this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||a)(f(O),f(Xe),f(Ve),f(Fe))};static \u0275cmp=x({type:a,selectors:[["app-friend-request-table-page"]],decls:36,vars:7,consts:[[1,"table-page-container"],[1,"page-header"],["mat-icon-button","",1,"back-button",3,"click"],["mat-fab","","color","primary",1,"fab-button",3,"click"],[1,"filters-section"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Etsi nimell\xE4, kiinnostuksilla, kaupungilla...",3,"ngModelChange","ngModel"],["matPrefix",""],["appearance","outline",1,"filter-field"],[3,"ngModelChange","ngModel"],["value","all"],["value","active"],["value","closed"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["class","loading-container",4,"ngIf"],["class","requests-container",4,"ngIf"],[1,"loading-container"],[1,"requests-container"],["class","empty-state",4,"ngIf"],["class","requests-grid",4,"ngIf"],[1,"empty-state"],[4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],[1,"requests-grid"],[3,"request","isOwner","sendMessage","proposePlaytime","edit","delete","close",4,"ngFor","ngForOf"],[3,"sendMessage","proposePlaytime","edit","delete","close","request","isOwner"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"header",1)(2,"button",2),u("click",function(){return t.goBack()}),n(3,"mat-icon"),r(4,"arrow_back"),i()(),n(5,"h1"),r(6,"Kaverihakuilmoitukset"),i(),n(7,"button",3),u("click",function(){return t.onCreateRequest()}),n(8,"mat-icon"),r(9,"add"),i()()(),n(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),r(13,"Hae"),i(),n(14,"input",6),de("ngModelChange",function(d){return me(t.searchText,d)||(t.searchText=d),d}),u("ngModelChange",function(){return t.onSearchChange()}),i(),n(15,"mat-icon",7),r(16,"search"),i()(),n(17,"mat-form-field",8)(18,"mat-label"),r(19,"Tila"),i(),n(20,"mat-select",9),de("ngModelChange",function(d){return me(t.selectedStatus,d)||(t.selectedStatus=d),d}),u("ngModelChange",function(){return t.onStatusChange()}),n(21,"mat-option",10),r(22,"Kaikki"),i(),n(23,"mat-option",11),r(24,"Aktiiviset"),i(),n(25,"mat-option",12),r(26,"Ratkaistut"),i()()(),n(27,"mat-form-field",8)(28,"mat-label"),r(29,"Ik\xE4"),i(),n(30,"mat-select",9),de("ngModelChange",function(d){return me(t.selectedAge,d)||(t.selectedAge=d),d}),u("ngModelChange",function(){return t.onAgeChange()}),n(31,"mat-option",13),r(32,"Kaikki i\xE4t"),i(),c(33,At,2,2,"mat-option",14),i()()(),c(34,Lt,2,0,"div",15)(35,Wt,3,2,"div",16),i()),e&2&&(s(14),le("ngModel",t.searchText),s(6),le("ngModel",t.selectedStatus),s(10),le("ngModel",t.selectedAge),s(),m("value",null),s(2),m("ngForOf",t.ageOptions),s(),m("ngIf",t.isLoading),s(),m("ngIf",!t.isLoading))},dependencies:[q,k,E,Le,D,I,Ae,P,S,Re,Te,L,A,R,w,F,Be,V,T,ae,ne,ie,Qe,Je,pe],styles:[".table-page-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f5f5f5;padding-bottom:80px}.page-header[_ngcontent-%COMP%]{background-color:#fff;box-shadow:0 2px 4px #0000001a;padding:16px;display:flex;align-items:center;gap:16px;position:sticky;top:0;z-index:100}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{flex:1;margin:0;font-size:20px;font-weight:600;color:#673ab7}.page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%], .page-header[_ngcontent-%COMP%]   .fab-button[_ngcontent-%COMP%]{flex-shrink:0}.page-header[_ngcontent-%COMP%]   .fab-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.filters-section[_ngcontent-%COMP%]{background-color:#fff;padding:16px;display:flex;gap:16px;flex-wrap:wrap;box-shadow:0 2px 4px #0000000d}.filters-section[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]{flex:1;min-width:250px}.filters-section[_ngcontent-%COMP%]   .filter-field[_ngcontent-%COMP%]{min-width:150px}@media (max-width: 768px){.filters-section[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%], .filters-section[_ngcontent-%COMP%]   .filter-field[_ngcontent-%COMP%]{width:100%;min-width:100%}}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px}.listings-container[_ngcontent-%COMP%]{padding:24px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 24px;text-align:center;color:#0009}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#0000004d;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:20px;color:#000000de}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 24px;font-size:14px}.empty-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;margin-right:8px;color:#fff}.listings-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:24px}@media (max-width: 768px){.listings-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px}}"]})};export{lt as FriendRequestTablePageComponent};
