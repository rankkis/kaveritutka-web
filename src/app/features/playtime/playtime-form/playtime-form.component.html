<form [formGroup]="playtimeForm" class="playtime-form">

  <!-- Meeting Section -->
  <fieldset class="form-fieldset">
    <legend class="fieldset-legend">{{ playground.name }}</legend>

    <!-- Parent Name -->
    <mat-form-field appearance="outline" class="full-width" floatLabel="always">
      <mat-label>Nimi (valinnainen)</mat-label>
      <input matInput formControlName="parentName" placeholder="Voit jättää tyhjäksi">
    </mat-form-field>

    <!-- Date Selection -->
    <div class="form-section">
      <label class="section-label">Päivämäärä</label>
      <div class="chip-row">
        <button type="button"
                *ngFor="let date of dateOptions"
                class="selection-chip"
                [class.selected]="selectedDate === date.value"
                (click)="selectDate(date.value)">
          {{ date.label }}
        </button>
      </div>
    </div>

    <!-- Time Selection -->
    <div class="form-section">
      <label class="section-label">Kellonaika</label>
      <mat-form-field appearance="outline" class="full-width">
        <mat-select formControlName="scheduledTime">
          <mat-option *ngFor="let time of timeOptions" [value]="time">
            {{ getTimeLabel(time) }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Duration Selection -->
    <div class="form-section">
      <label class="section-label">Kesto</label>
      <div class="chip-row">
        <button type="button"
                *ngFor="let duration of durationOptions"
                class="selection-chip duration-chip"
                [class.selected]="selectedDuration === duration.value"
                (click)="selectDuration(duration.value)">
          {{ duration.label }}
        </button>
      </div>
    </div>

    <!-- Additional Info -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Lisätiedot (valinnainen)</mat-label>
      <textarea matInput formControlName="additionalInfo"
                rows="3"
                placeholder="Esim. kuinka kauan oleskelette, mitä välineitä otatte mukaan, jne."></textarea>
    </mat-form-field>
  </fieldset>

  <!-- Participants Sections -->
  <fieldset class="form-fieldset" *ngFor="let participant of participants; let i = index">
    <legend class="fieldset-legend">
      {{ getParticipantTitle(i) }}
      <button type="button"
              *ngIf="participants.length > 1"
              class="remove-participant-btn"
              (click)="removeParticipant(i)">
        ✕
      </button>
    </legend>

    <!-- Age Selection -->
    <div class="form-section">
      <label class="section-label">Lapsen ikä</label>
      <div class="chip-row">
        <button type="button"
                *ngFor="let age of ageOptions"
                class="selection-chip age-chip"
                [class.selected]="participant.childAge === age"
                (click)="selectAge(i, age)">
          {{ age }}v
        </button>
      </div>
    </div>

    <!-- Gender Selection -->
    <div class="form-section">
      <label class="section-label">Sukupuoli (valinnainen)</label>
      <div class="chip-row">
        <button type="button"
                *ngFor="let gender of genderOptions"
                class="selection-chip gender-chip"
                [class.selected]="participant.childGender === gender.value"
                (click)="selectGender(i, gender.value)">
          <span class="icon">{{ gender.icon }}</span>
          <span class="label">{{ gender.label }}</span>
        </button>
        <button type="button"
                *ngIf="participant.childGender !== null"
                class="remove-selection-btn"
                (click)="removeGenderSelection(i)">
          Poista valinta
        </button>
      </div>
    </div>

    <!-- Interests Selection -->
    <div class="form-section">
      <label class="section-label">Kiinnostuksen kohteet (valitse vähintään yksi)</label>
      <div class="interests-grid">
        <button type="button"
                *ngFor="let interest of availableInterests"
                class="interest-chip"
                [class.selected]="isInterestSelected(i, interest.value)"
                (click)="toggleInterest(i, interest.value)">
          {{ interest.label }}
        </button>
      </div>
      <div class="error-message" *ngIf="submitted && participant.interests.length === 0">
        Valitse vähintään yksi kiinnostuksen kohde
      </div>
    </div>

    <!-- Add Another Button -->
    <button type="button"
            *ngIf="i === participants.length - 1 && isParticipantValid(i)"
            class="add-participant-btn"
            (click)="addParticipant()">
      + Lisää osallistuja
    </button>
  </fieldset>

  <!-- Form Actions -->
  <div class="form-actions">
    <button type="button" class="cancel-btn" (click)="onCancel()">Peruuta</button>
    <button type="button"
            class="submit-btn"
            (click)="onSubmit()"
            [disabled]="!playtimeForm.valid || !areAllParticipantsValid()">
      Leikkimään!
    </button>
  </div>
</form>
