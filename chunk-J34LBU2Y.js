import{a as re,b as oe}from"./chunk-VB2HNPEO.js";import{a as ae,b as me,c as le,f as se,g as pe}from"./chunk-F2P2FTFN.js";import{a as B,b as G}from"./chunk-VQVCNQR2.js";import{C as ie,D as ne,b as R,d as _,f as q,g as A,j as L,k as H,l as K,m as J,n as Q,p as W,q as X,r as Y,s as Z,x as ee,y as te}from"./chunk-JZXY3VKR.js";import{a as V}from"./chunk-765JHOPI.js";import{o as j,p as z}from"./chunk-R7O3L3SZ.js";import"./chunk-YAXX6ZQB.js";import"./chunk-X5YLR3NI.js";import{f as F,h as k,i as T,r as D,t as $}from"./chunk-HGBHGORQ.js";import{$a as o,$b as a,Ab as l,D as M,Ib as r,Jb as n,Kb as u,Lb as S,Mb as E,Ob as O,Qb as N,Rb as s,W as C,ac as w,bc as g,da as c,g as f,jc as I,kc as U,la as y,lb as P,ma as v,n as x,rb as d,s as b,t as h}from"./chunk-LH7KODYS.js";import"./chunk-ODN5LVDJ.js";function de(t,i){if(t&1&&(r(0,"mat-error"),a(1),n()),t&2){let e=s(2);o(),g(" ",e.getDisplayNameError()," ")}}function fe(t,i){if(t&1&&(r(0,"div",13)(1,"mat-icon"),a(2,"error"),n(),r(3,"span"),a(4),n()()),t&2){let e=s().ngIf;o(4),w(e.errorMessage)}}function ue(t,i){t&1&&u(0,"mat-spinner",14)}function ge(t,i){if(t&1&&(r(0,"span"),a(1),n()),t&2){let e=s().ngIf;o(),g(" ",e.currentDisplayName?"P\xE4ivit\xE4 profiili":"Tallenna"," ")}}function _e(t,i){t&1&&(r(0,"span"),a(1,"Tallennetaan..."),n())}function xe(t,i){if(t&1){let e=O();S(0),r(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title")(4,"mat-icon",3),a(5,"person"),n(),a(6," K\xE4ytt\xE4j\xE4profiili "),n()(),r(7,"mat-card-content")(8,"div",4)(9,"mat-icon"),a(10,"info"),n(),r(11,"p"),a(12," T\xE4m\xE4 nimi n\xE4kyy palvelussa muille k\xE4ytt\xE4jille. "),n()(),r(13,"form",5),N("ngSubmit",function(){y(e);let p=s();return v(p.onSubmit())}),r(14,"mat-form-field",6)(15,"mat-label"),a(16,"Nimi"),n(),u(17,"input",7),r(18,"mat-hint"),a(19," Nimi voi olla koko nimesi tai pelkk\xE4 etunimesi tai lempinimesi. "),n(),d(20,de,2,1,"mat-error",1),n(),d(21,fe,5,1,"div",8),r(22,"div",9)(23,"button",10)(24,"span",11),d(25,ue,1,0,"mat-spinner",12)(26,ge,2,1,"span",1)(27,_e,2,0,"span",1),n()()()()()(),E()}if(t&2){let e,m=i.ngIf,p=s();o(13),l("formGroup",p.profileForm),o(4),l("disabled",m.isSubmitting),o(3),l("ngIf",((e=p.profileForm.get("displayName"))==null?null:e.invalid)&&((e=p.profileForm.get("displayName"))==null?null:e.touched)),o(),l("ngIf",m.errorMessage),o(2),l("disabled",m.isSubmitting),o(2),l("ngIf",m.isSubmitting),o(),l("ngIf",!m.isSubmitting),o(),l("ngIf",m.isSubmitting)}}var ce=class t{activatedRoute=c(D);fb=c(Q);router=c($);userService=c(V);isSubmitting$=new f(!1);errorMessage$=new f(null);profileForm;returnUrl=null;vm$=h({user:this.userService.getCurrentUser(),isSubmitting:this.isSubmitting$,errorMessage:this.errorMessage$}).pipe(b(({user:i,isSubmitting:e,errorMessage:m})=>({currentDisplayName:i?.displayName||null,isLoading:!1,errorMessage:m,isSubmitting:e})));constructor(){this.profileForm=this.fb.group({displayName:["",[_.required,_.minLength(1)]]}),this.returnUrl=this.activatedRoute.snapshot.queryParams.returnUrl||null,this.userService.getCurrentUser().subscribe(i=>{i?.displayName&&this.profileForm.patchValue({displayName:i.displayName})})}onSubmit(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched();return}this.isSubmitting$.next(!0),this.errorMessage$.next(null);let i={displayName:this.profileForm.value.displayName};this.userService.updateProfile(i).pipe(C(()=>{this.isSubmitting$.next(!1);let e=this.returnUrl||"/map";this.router.navigateByUrl(e)}),M(e=>(console.error("Error updating profile:",e),this.errorMessage$.next(e.message||"Profiilin p\xE4ivitys ep\xE4onnistui"),this.isSubmitting$.next(!1),x(null)))).subscribe()}getDisplayNameError(){let i=this.profileForm.get("displayName");return i?.hasError("required")?"Nimi on pakollinen":i?.hasError("minlength")?"Nimi on liian lyhyt":""}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=P({type:t,selectors:[["app-user-profile"]],decls:3,vars:3,consts:[[1,"profile-container"],[4,"ngIf"],[1,"profile-card"],[1,"profile-icon"],[1,"info-box"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","type","text","formControlName","displayName","placeholder","Esim. Matti, Matti V tai Matikka","required","",3,"disabled"],["class","error-message",4,"ngIf"],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",1,"submit-button",3,"disabled"],[1,"button-content"],["diameter","20","class","button-spinner",4,"ngIf"],[1,"error-message"],["diameter","20",1,"button-spinner"]],template:function(e,m){e&1&&(r(0,"div",0),d(1,xe,28,8,"ng-container",1),I(2,"async"),n()),e&2&&(o(),l("ngIf",U(2,1,m.vm$)))},dependencies:[T,F,k,W,L,R,q,A,J,H,K,te,ee,X,Z,Y,ne,ie,z,j,pe,ae,le,se,me,G,B,oe,re],styles:[".profile-container[_ngcontent-%COMP%]{min-height:100%;display:flex;align-items:center;justify-content:center;padding:2rem;background:linear-gradient(135deg,#667eea,#764ba2)}@media (max-width: 768px){.profile-container[_ngcontent-%COMP%]{padding:2rem 1rem 1rem;align-items:flex-start}}.profile-card[_ngcontent-%COMP%]{max-width:600px;width:100%;box-shadow:0 8px 32px #0000001a}@media (max-width: 768px){.profile-card[_ngcontent-%COMP%]{max-width:100%}}mat-card-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:1.5rem;color:#2d3748}.profile-icon[_ngcontent-%COMP%]{color:#667eea;font-size:2rem;width:2rem;height:2rem}.info-box[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;padding:1rem;background-color:#e3f2fd;border-left:4px solid #2196f3;border-radius:4px;margin-bottom:1.5rem}.info-box[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2196f3;font-size:1.5rem;width:1.5rem;height:1.5rem;flex-shrink:0}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#1565c0;line-height:1.5;font-size:.95rem}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}@media (max-width: 768px){.full-width[_ngcontent-%COMP%]{margin-bottom:2rem}}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background-color:#ffebee;border-left:4px solid #f44336;border-radius:4px;margin-bottom:1rem;color:#c62828}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#f44336;font-size:1.25rem;width:1.25rem;height:1.25rem}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:1.5rem}@media (max-width: 768px){.form-actions[_ngcontent-%COMP%]{justify-content:stretch}.form-actions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{width:100%}}.submit-button[_ngcontent-%COMP%]{min-width:150px}.submit-button[_ngcontent-%COMP%]   .button-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem}.submit-button[_ngcontent-%COMP%]   .button-spinner[_ngcontent-%COMP%]{display:inline-block}  .profile-card .mat-mdc-form-field .mdc-text-field{background-color:#fff}  .profile-card .mat-mdc-form-field-hint{font-size:.85rem;color:#718096;line-height:1.4}"]})};export{ce as UserProfileComponent};
